<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/1135089/"> 1135089</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/cfb4410fe52d979e8687f3587466942bfd1b6c56">cfb4410fe52d979e8687f3587466942bfd1b6c56</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/1135076/">1135076</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/c2d5109c65bf76fc277c0a4ace3d463a3a554f63">c2d5109c65bf76fc277c0a4ace3d463a3a554f63</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   cfb4410fe52d979e8687f3587466942bfd1b6c56
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/cfb4410fe52d979e8687f3587466942bfd1b6c56">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/cfb4410fe52d979e8687f3587466942bfd1b6c56.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   Liam Brady &lt;lbrady@google.com&gt;
  </td>
  <td>
   Tue Apr 25 08:15:43 2023
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Tue Apr 25 08:15:43 2023
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/cfb4410fe52d979e8687f3587466942bfd1b6c56/">
    899c5e6a18faf33c484bd4da866a92fc58e6883e
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/cfb4410fe52d979e8687f3587466942bfd1b6c56%5E">
    71069400136a1b2492ee16807b036bda87c67539
   </a>
   <span>
    [
    <a href="/chromium/src/+/cfb4410fe52d979e8687f3587466942bfd1b6c56%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table><hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">Fix permissions issue with iframes nested in fenced frames.

This CL fixes a bug related to permissions policies in iframes nested
within fenced frames. For policies that are not explicitly disabled in a
fenced frame, if the fenced frame's document response disallows a
permissions policy, it is still allowed in the iframe nested within the
fenced frame. It was first found with the Attribution Reporting API
policy, but this bug applies to any permissions policy that can be set
in a fenced frame.

The bug occurred because iframes nested inside of fenced frames were
always treated as fenced frames, and their permissions policies were set
with `PermissionsPolicy::CreateForFencedFrame()`, which intentionally
does not look at parent frames. While this was suitable when permissions
policies were completely disabled in fenced frames, it became
problematic when permissions started being allowed (including allowing
a document to further restrict permissions), and child frames needed to
access the embedding fenced frame's permissions policies to know which
permissions to disable.

After this fix, `PermissionsPolicy::CreateForFencedFrame()` will only
be called on a fenced frame root. Subframes nested in fenced frames
will now use the `PermissionsPolicy::CreateFromParentPolicy()` method
the same way that subframes outside of fenced frame trees currently
do.

This CL adds WPTs to check that iframes nested in fenced frames have
their permissions set as expected.

This CL also fixes an issue with client hint code that was causing an
iframe nested in a fenced frame to pull the permissions policy from the
outermost main frame rather than its fenced frame root.

Bug: 1428913
Change-Id: <a href="https://chromium-review.googlesource.com/#/q/I590425d59a8f19e37313bd3dedf0d56b35c87f80">I590425d59a8f19e37313bd3dedf0d56b35c87f80</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/4377538">https://chromium-review.googlesource.com/c/chromium/src/+/4377538</a>
Code-Coverage: Findit &lt;findit-for-me@appspot.gserviceaccount.com&gt;
Commit-Queue: Ari Chivukula &lt;arichiv@chromium.org&gt;
Reviewed-by: Ari Chivukula &lt;arichiv@chromium.org&gt;
Cr-Commit-Position: refs/heads/main@{#1135089}
</pre>

</body>
</html>
