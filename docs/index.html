<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/1215501/"> 1215501</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/bbbcef0fd5821181da6374a6c3d28394c21083a0">bbbcef0fd5821181da6374a6c3d28394c21083a0</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/1215495/">1215495</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/afab0bdacce73708c20053382c3f303218621d50">afab0bdacce73708c20053382c3f303218621d50</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   bbbcef0fd5821181da6374a6c3d28394c21083a0
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/bbbcef0fd5821181da6374a6c3d28394c21083a0">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/bbbcef0fd5821181da6374a6c3d28394c21083a0.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   Michael Ludwig &lt;michaelludwig@google.com&gt;
  </td>
  <td>
   Thu Oct 26 14:33:00 2023
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Thu Oct 26 14:33:00 2023
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/bbbcef0fd5821181da6374a6c3d28394c21083a0/">
    91207a7588ad7694e4407aa52ccdcb291a5c9f6b
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/bbbcef0fd5821181da6374a6c3d28394c21083a0%5E">
    e731a3c0e048b58b4326899757be83ed9a5c142b
   </a>
   <span>
    [
    <a href="/chromium/src/+/bbbcef0fd5821181da6374a6c3d28394c21083a0%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table>
<hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">Improve backdrop filter calculations in SkiaRenderer

Pulls all of the bounds analysis for how to clip the output and input
of a backdrop filter into the CalculateRPDQParams function. Improves
the calculations for the `filter_bounds` value to be tighter for
backdrop filters since their output is always restricted.

Optimizes more cases to have backdrop output restricted by just a
clip instead of introducing an image filter node at the end. Switches
the input cropping node from a no-op Offset(0,0) to a proper `Crop`
that can define the boundary tilemode to apply (kClamp). This
actually fixes the behavior in the backdrop-offset unit test. It also
makes it possible to easily experiment with using mirror tiling for
content that is off screen.

Re-organizes some of the logic for clipping or clearing the backdrop
bounds into helper functions in RPDQParams so that
PrepareCanvasForRPDQ is more readable.

The backdrop logic to determine if an input crop is needed or not
used to have a bug (exposed when removing the staging flag
SK_USE_LEGACY_CONTENT_BOUNDS_PROPAGATION). The input bounds
calculation needs to use a null src rect so that the returned value
has no additional content restriction. If it *still* matches the
target output bounds, then we know it's not a pixel-moving backdrop
filter. I confirmed that the backdrop boundary layout tests work
correctly with and without the above staging flag.

Updates the conversion of FilterOperations to PaintFilter to define
the tiling geometry, so that clamp, mirror, and repeat explicitly
apply to the edges of a layer (instead of previously just the edge
of whatever image size happened to come through the pipeline). This
currently is only taken advantage of in SkiaRenderer,
SoftwareRenderer continues to use the legacy (less stable/defined)
tiling behavior.

Bug: b/40040615
Bug: chromium:978031
Bug: chromium:1473071
Bug: chromium:1451898
Change-Id: <a href="https://chromium-review.googlesource.com/#/q/I65aef30266129b2b76cb7c9d38a38e8444c6789a">I65aef30266129b2b76cb7c9d38a38e8444c6789a</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/4936570">https://chromium-review.googlesource.com/c/chromium/src/+/4936570</a>
Commit-Queue: Michael Ludwig &lt;michaelludwig@google.com&gt;
Reviewed-by: Kyle Charbonneau &lt;kylechar@chromium.org&gt;
Reviewed-by: Andrew Xu &lt;andrewxu@chromium.org&gt;
Reviewed-by: Xiyuan Xia &lt;xiyuan@chromium.org&gt;
Cr-Commit-Position: refs/heads/main@{#1215501}
</pre>

</body>
</html>
