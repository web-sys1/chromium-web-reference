<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/870653/"> 870653</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/4c3854799005b3adf792fd762a8fec5fb3ce70cc">4c3854799005b3adf792fd762a8fec5fb3ce70cc</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/870649/">870649</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/7ff36e10afab2495f5ebb1b15ae889ee96291f92">7ff36e10afab2495f5ebb1b15ae889ee96291f92</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   4c3854799005b3adf792fd762a8fec5fb3ce70cc
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/4c3854799005b3adf792fd762a8fec5fb3ce70cc">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/4c3854799005b3adf792fd762a8fec5fb3ce70cc.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   Fabrice de Gans-Riberi &lt;fdegans@chromium.org&gt;
  </td>
  <td>
   Thu Apr 08 19:39:21 2021
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Thu Apr 08 19:39:21 2021
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/4c3854799005b3adf792fd762a8fec5fb3ce70cc/">
    0b8876f3fa8cc2442783fbf1e0c3054034018bb7
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/4c3854799005b3adf792fd762a8fec5fb3ce70cc%5E">
    755471e305b5c8919725ae067b8f2269b640f04e
   </a>
   <span>
    [
    <a href="/chromium/src/+/4c3854799005b3adf792fd762a8fec5fb3ce70cc%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table><hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">[fuchsia] Fix a use-after-free in WebEngineURLLoaderThrottle

It was assumed that all WebEngineURLLoaderThrottles would be
destroyed before their corresponding RenderFrame was destroyed.
This assumption is incorrect, resulting in a potential use-after-free
when attempting to access a UrlRequestRulesReceiver. This object has
its lifespan bound to a RenderFrameObserver and can be destroyed
before all of the WebEngineURLLoaderThrottles that use it have been
destroyed.

This CL fixes the issue by passing the UrlRequestRewriteRules directly
to the WebEngineURLLoaderThrottle constructor. As a result, URL
requests in-flight while a user updates the rewrite rules will use the
older version of the rewrite rules. We deem this change in behavior to
be acceptable since such an occurrence is bound to be rare and the
delay between a WebEngineURLLoaderThrottle creation and its actual use
is bound to be short.

This CL also modifies the logic a bit to skip creation of the throttle
if there are no rewrite rules to apply at the time of the network
request creation. Since the rules provider should now be accessed from
the same thread in both the renderer and the browser process, the locks
around accessing the rules have been removed. Instead, each throttle
keeps a reference to a thread-safe ref-counted set of rules.

Since this fix is still speculative, the extra logs for debugging this
issue are left in place in this CL, until we get data confirming the
crashes are no longer occurring.

Bug: 1181062
Change-Id: <a href="https://chromium-review.googlesource.com/#/q/I580664f9ed2fdf9874e36b1cbc508c2301ef36e5">I580664f9ed2fdf9874e36b1cbc508c2301ef36e5</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/2812464">https://chromium-review.googlesource.com/c/chromium/src/+/2812464</a>
Commit-Queue: Fabrice de Gans-Riberi &lt;fdegans@chromium.org&gt;
Commit-Queue: Kevin Marshall &lt;kmarshall@chromium.org&gt;
Reviewed-by: Kevin Marshall &lt;kmarshall@chromium.org&gt;
Reviewed-by: Wez &lt;wez@chromium.org&gt;
Cr-Commit-Position: refs/heads/master@{#870653}
</pre>

</body>
</html>
