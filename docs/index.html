<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/1112098/"> 1112098</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/57cbb3b72ae7cf88caf2869cc16968c66c8482b6">57cbb3b72ae7cf88caf2869cc16968c66c8482b6</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/1112067/">1112067</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/77e1ed1d72712454bcc392f95c8e746c0b007194">77e1ed1d72712454bcc392f95c8e746c0b007194</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   57cbb3b72ae7cf88caf2869cc16968c66c8482b6
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/57cbb3b72ae7cf88caf2869cc16968c66c8482b6">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/57cbb3b72ae7cf88caf2869cc16968c66c8482b6.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   Marcio Caroso &lt;msscaroso@gmail.com&gt;
  </td>
  <td>
   Thu Mar 02 08:39:47 2023
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Thu Mar 02 08:39:47 2023
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/57cbb3b72ae7cf88caf2869cc16968c66c8482b6/">
    a1e28d22428ef05a4fbefe45e73f0ba9223cb7a8
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/57cbb3b72ae7cf88caf2869cc16968c66c8482b6%5E">
    5b6979c43621893d550e829e4e68ef13980a2415
   </a>
   <span>
    [
    <a href="/chromium/src/+/57cbb3b72ae7cf88caf2869cc16968c66c8482b6%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table><hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">XHR defaults to text/xml if media type is invalid

XMLHTTPRequest is expected to default to text/xml when the
Content-Type fails to parse. But some web platform tests covering this
expectation were failing (xhr/responsexml-media-type.htm). When the
server returns a response with, for instance, 'Content-Type: bogus' or
'Content-Type: application', chromium wasn't setting the correct
default 'text/xml'. The issue is that XHR should have considered
'bogus' and 'application' invalid MIME types. According to
<a href="https://mimesniff.spec.whatwg.org/#parse-a-mime-type">https://mimesniff.spec.whatwg.org/#parse-a-mime-type</a> they are invalid.
In fact, both FireFox and Safari are passing these WPT test cases.
The chromium codebase has multiple MIME Type parsers with varying
behaviors about what is and what isn't a valid MIME type. This is an
interesting discussion about the subject
<a href="https://github.com/whatwg/mimesniff/issues/30#issuecomment-330762896.">https://github.com/whatwg/mimesniff/issues/30#issuecomment-330762896.</a>
The idea of this CL is to update the Content-Type parsing logic that
happens in XHR to use one of the other existing parsers. I believe we
should avoid creating a new one, since there are multiple already.
Looking at the options, there's HttpUtil::ParseContentType which
seems to be the one that best implements the spec. But it is often
used in the context of request header parsing. In
//net/base/mime_util there are two parsers that are used in
the parsing of response content-type. The proposal here is to move
//services/network/public/cpp/cors ExtractMIMETypeFromMediaType (which
uses //net/base/mime_util) to //net/base/mime_util and use it
from Blink's XHR. One caveat is that XHR is currently parsing multiple
Content-Type values in the same string. It simply reads the value
before the first comma. So I'm adding a flag to the moved
net::ExtractMIMETypeFromMediaType to toggle this behavior on,
but still leaving the other places without it, since it's
not part of the spec.

Bug: 1053973
Change-Id: <a href="https://chromium-review.googlesource.com/#/q/I8b27712aea30e2365e84886ffe2f7d4b251a4acf">I8b27712aea30e2365e84886ffe2f7d4b251a4acf</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/4241657">https://chromium-review.googlesource.com/c/chromium/src/+/4241657</a>
Reviewed-by: Kenichi Ishibashi &lt;bashi@chromium.org&gt;
Reviewed-by: Yoav Weiss &lt;yoavweiss@chromium.org&gt;
Commit-Queue: Yoav Weiss &lt;yoavweiss@chromium.org&gt;
Commit-Queue: Kenichi Ishibashi &lt;bashi@chromium.org&gt;
Cr-Commit-Position: refs/heads/main@{#1112098}
</pre>

</body>
</html>
