<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/913775/"> 913775</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/6d0eb35487af73d75eba7a00c4fb5f6aae9c84d7">6d0eb35487af73d75eba7a00c4fb5f6aae9c84d7</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/913774/">913774</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/7ba47d250e46af1335906ef41d888a8d996c7b5c">7ba47d250e46af1335906ef41d888a8d996c7b5c</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   6d0eb35487af73d75eba7a00c4fb5f6aae9c84d7
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/6d0eb35487af73d75eba7a00c4fb5f6aae9c84d7">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/6d0eb35487af73d75eba7a00c4fb5f6aae9c84d7.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   Andrew Paseltiner &lt;apaseltiner@chromium.org&gt;
  </td>
  <td>
   Fri Aug 20 13:44:32 2021
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Fri Aug 20 13:44:32 2021
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/6d0eb35487af73d75eba7a00c4fb5f6aae9c84d7/">
    e22cf3000f998932955fa441e049e4ffeb883559
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/6d0eb35487af73d75eba7a00c4fb5f6aae9c84d7%5E">
    7ba47d250e46af1335906ef41d888a8d996c7b5c
   </a>
   <span>
    [
    <a href="/chromium/src/+/6d0eb35487af73d75eba7a00c4fb5f6aae9c84d7%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table><hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">[attribution_reporting] Use single callback for ConversionReporter

Instead of one per conversion ID.

Prior to this CL, if two reports for the same conversion ID were added
to the ConversionReporter, the earlier one's callback would be dropped
and never run. For timed sends, this is fine, as the only action
performed by the callback is deleting the report, for which it doesn't
matter which of the two callbacks is run, since their behavior is the
same. But if at least one of the callbacks corresponds to a
send-all-reports-now action triggered by the internals UI, then the
callback acts as a barrier that ensures that the UI is only refreshed
once all the reports have been sent. If that callback isn't run, then
the UI will never automatically refresh.

This CL makes this situation impossible, by using only a single callback
for the ConversionReporter, specified at construction time, and removing
the internals UI barrier. Instead, the ConversionManager tracks the
outstanding report IDs; once the count reaches zero, it runs the
internals UI callback.

To simplify the implementation further, we allow only a single
outstanding send-all-reports-now action, as we expect multiple
simultaneous calls to be rare and without benefit.

Change-Id: <a href="https://chromium-review.googlesource.com/#/q/I2a555d78a5740da03bdf64cd1ec87d7756e93dd6">I2a555d78a5740da03bdf64cd1ec87d7756e93dd6</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/3107568">https://chromium-review.googlesource.com/c/chromium/src/+/3107568</a>
Commit-Queue: Andrew Paseltiner &lt;apaseltiner@chromium.org&gt;
Reviewed-by: John Delaney &lt;johnidel@chromium.org&gt;
Cr-Commit-Position: refs/heads/main@{#913775}
</pre>

</body>
</html>
