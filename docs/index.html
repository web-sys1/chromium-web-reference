<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/1329121/"> 1329121</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/dd2888041375720ca0a15df13594e27385ea28ae">dd2888041375720ca0a15df13594e27385ea28ae</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/1329057/">1329057</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/e58452f7938f2f572a9bb2ae044f6f28356a2e8e">e58452f7938f2f572a9bb2ae044f6f28356a2e8e</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   dd2888041375720ca0a15df13594e27385ea28ae
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/dd2888041375720ca0a15df13594e27385ea28ae">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/dd2888041375720ca0a15df13594e27385ea28ae.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   Peter Wen &lt;wnwen@chromium.org&gt;
  </td>
  <td>
   Wed Jul 17 21:04:19 2024
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Wed Jul 17 21:04:19 2024
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/dd2888041375720ca0a15df13594e27385ea28ae/">
    b3b17650b1cbf9923a055bc20a2f3b1853043245
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/dd2888041375720ca0a15df13594e27385ea28ae%5E">
    7db7ed89cff6698e553860ba280593ee8f38b8cb
   </a>
   <span>
    [
    <a href="/chromium/src/+/dd2888041375720ca0a15df13594e27385ea28ae%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table>
<hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">pgo: Run per story benchmarks on android

Each telemetry benchmark has one or more stories associated with it. PGO
on Android works by running an entire benchmark and all its associated
stories and then copying over the files in
/data/data/&lt;package_name&gt;/cache/pgo_profiles/*.profraw and merging them
into a .profdata file. The .profdata files from various benchmark runs
are then merged into a final profile.profdata file which is used in
PGO-optimized builds.

The telemetry platform code for Android starts the Android browser at
the beginning of each story and sets up it profile. During profile setup
all the files (except those in lib/) in /data/data/&lt;package_name&gt;/* are
deleted. After each story run completes, the PGO profile data associated
with that story run are saved to
/data/data/&lt;package_name&gt;/cache/pgo_profiles/*.profraw files. This means
that any subsequent stories start by clearing the PGO profile data
collected during the preceding story run. Running any benchmark with
more than one story results in only the PGO profile data from the last
story in that benchmark being kept at the end of the benchmark.

In order to obtain more comprehensive PGO profile coverage, this CL (on
Android only) splits each benchmark by its stories, so that each story
gets its own explicit benchmark run, independent from the others. This
also has the benefit of enabling per-story repeats which in turn greatly
reduces flakiness associated with any one of the stories failing causing
the entire benchmark to fail. In principle this has the same effect for
a multi-story benchmark as it does for a multi-benchmark suite. See
<a href="https://crrev.com/c/5680092">https://crrev.com/c/5680092</a> for an example of improving from 13% success
rate to 96% success rate just by adding repeats.

This CL also addresses flakiness in PGO profile generation and merging
on the LLVM side. Either profile merging would fail explicitly with an
error code, or it would succeed but print out a warning to stderr that
it produced an invalid profile. This CL ensures that the benchmark or
story is repeated in both failure modes, as otherwise the failure
propagates to the final merge of up to 16 *.profdata files, and that
final merge will fail if any of the 16 *.profdata files are invalid
individually.

This CL also adds a passthrough for the -q flag to run_benchmark as that
greatly reduces the noisiness of run_benchmark for successful runs.
This way devs can focus on failure cases instead of length output from
successful runs.

This CL extends handling for Temporal PGO to all `llvm-profdata merge`
commands. This codepath will be tested and extended in a later CL.

The new --print-only-runnable flag for run_benchmark is used to collect
the list of stories to run individually.

Bug: 352333007
Change-Id: <a href="https://chromium-review.googlesource.com/#/q/Ia5f839bc79bcc534c4df38b4366550bf00129229">Ia5f839bc79bcc534c4df38b4366550bf00129229</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/5718532">https://chromium-review.googlesource.com/c/chromium/src/+/5718532</a>
Auto-Submit: Peter Wen &lt;wnwen@chromium.org&gt;
Commit-Queue: Peter Wen &lt;wnwen@chromium.org&gt;
Reviewed-by: Andrew Grieve &lt;agrieve@chromium.org&gt;
Cr-Commit-Position: refs/heads/main@{#1329121}
</pre>

</body>
</html>
