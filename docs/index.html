<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/1118165/"> 1118165</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/8f2025871e586e99dd48d382d32bfbf760dc4447">8f2025871e586e99dd48d382d32bfbf760dc4447</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/1118102/">1118102</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/8e282d75f340dc0d72ae51d8018fc7606ffb74d1">8e282d75f340dc0d72ae51d8018fc7606ffb74d1</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   8f2025871e586e99dd48d382d32bfbf760dc4447
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/8f2025871e586e99dd48d382d32bfbf760dc4447">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/8f2025871e586e99dd48d382d32bfbf760dc4447.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   Maks Orlovich &lt;morlovich@chromium.org&gt;
  </td>
  <td>
   Thu Mar 16 17:10:02 2023
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Thu Mar 16 17:10:02 2023
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/8f2025871e586e99dd48d382d32bfbf760dc4447/">
    423300d4cc75c7f2db8710e9dc4ffe2834db38bd
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/8f2025871e586e99dd48d382d32bfbf760dc4447%5E">
    dbfb5d097f53e92c29f899987627f553d4943db3
   </a>
   <span>
    [
    <a href="/chromium/src/+/8f2025871e586e99dd48d382d32bfbf760dc4447%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table><hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">FLEDGE: Change how cleanup of V8 state for WorkletLoader works

In case of WorkletLoader being destroyed before download + compile result has been reported to main thread, cleaning up previously relied on the V8 -&gt; main thread callback being destroyed on main thread. This caused problem since at exit we block for AuctionV8Helper shutdown, and the callback was keeping it alive (and the blocking was preventing us from returning to the event loop and cleaning up the callback).

Instead, keep ownership of the Result object with WorkletLoader until it's handed over to its client; it will directly queue up V8 thread clean up in the early-destruction case w/o relying on a round trip.

(Credit to Matt Menke for providing a repro, helping me close some gaps in my analysis, and suggesting a much better fix than I had).

Bug: 1421754

Change-Id: <a href="https://chromium-review.googlesource.com/#/q/I85207dafb546e97ee697052d0f25596fcbb968b7">I85207dafb546e97ee697052d0f25596fcbb968b7</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/4343291">https://chromium-review.googlesource.com/c/chromium/src/+/4343291</a>
Commit-Queue: Maks Orlovich &lt;morlovich@chromium.org&gt;
Reviewed-by: Russ Hamilton &lt;behamilton@google.com&gt;
Cr-Commit-Position: refs/heads/main@{#1118165}
</pre>

</body>
</html>
