<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/921736/"> 921736</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/b87c7a4269d3531e432dd455e18d787aadac2642">b87c7a4269d3531e432dd455e18d787aadac2642</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/921659/">921659</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/772f00eaee67c393ec838b9fa6f28b52e8f13abb">772f00eaee67c393ec838b9fa6f28b52e8f13abb</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   b87c7a4269d3531e432dd455e18d787aadac2642
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/b87c7a4269d3531e432dd455e18d787aadac2642">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/b87c7a4269d3531e432dd455e18d787aadac2642.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   Caitlin Fischer &lt;caitlinfischer@google.com&gt;
  </td>
  <td>
   Wed Sep 15 17:43:42 2021
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Wed Sep 15 17:43:42 2021
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/b87c7a4269d3531e432dd455e18d787aadac2642/">
    13c243ba421ae42677cb64747bb9d9badb70496e
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/b87c7a4269d3531e432dd455e18d787aadac2642%5E">
    168d2356490778812b984f49d66d95b8a4b9c7da
   </a>
   <span>
    [
    <a href="/chromium/src/+/b87c7a4269d3531e432dd455e18d787aadac2642%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table><hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">Instantiate the FieldTrialList earlier in Android WebLayer and WebView.

Moving the instantiation earlier on these platforms is being moved out
of crrev.com/c/3137621 in case this causes problems.

The motivation behind this change and crrev.com/c/3137621 is being able
to assign clients to experiment groups when the CleanExitBeacon init
steps occur, as in crrev.com/c/3120545.

As a part of this change, the instantiation of the FieldTrialList on
Android WebLayer and WebView is moved earlier. This is necessary because
we can't write the beacon value before initializing the CleanExitBeacon,
and we can't initialize the beacon until after the FieldTrialList has
been instantiated. However, with the status quo implementation, it is
possible for WL or WV to try to write the beacon value via the below
sequence of calls before the FieldTrialList has been instantiated.

AndroidMetricsServiceClient::Initialize()
AndroidMetricsServiceClient::MaybeStartMetrics()
AndroidMetricsServiceClient::RegisterMetricsProvidersAndInitState()
MetricsService::InitializeMetricsRecordingState()
MetricsService::InitializeMetricsState()
CleanExitBeacon::WriteBeaconValue()

This happens when AndroidMetricsServiceClient::SetHaveMetricsConsent()
returns before AndroidMetricsServiceClient::Initialize().

Bug: 1249496, 1246410
Change-Id: <a href="https://chromium-review.googlesource.com/#/q/I6e7df9656a5aea0d549e855ad17755f6ad7f2b88">I6e7df9656a5aea0d549e855ad17755f6ad7f2b88</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/3160866">https://chromium-review.googlesource.com/c/chromium/src/+/3160866</a>
Commit-Queue: Caitlin Fischer &lt;caitlinfischer@google.com&gt;
Reviewed-by: Scott Violet &lt;sky@chromium.org&gt;
Reviewed-by: Nate Fischer &lt;ntfschr@chromium.org&gt;
Reviewed-by: Alexei Svitkine &lt;asvitkine@chromium.org&gt;
Cr-Commit-Position: refs/heads/main@{#921736}
</pre>

</body>
</html>
