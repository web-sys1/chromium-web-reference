<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/954534/"> 954534</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/181847e1ac76e8b26b392cd524100c7b1c0c407e">181847e1ac76e8b26b392cd524100c7b1c0c407e</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/954536/">954536</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/72e0ad5cd06387ec460f363112e9a712df756b5c">72e0ad5cd06387ec460f363112e9a712df756b5c</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   181847e1ac76e8b26b392cd524100c7b1c0c407e
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/181847e1ac76e8b26b392cd524100c7b1c0c407e">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/181847e1ac76e8b26b392cd524100c7b1c0c407e.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   Devlin Cronin &lt;rdevlin.cronin@chromium.org&gt;
  </td>
  <td>
   Thu Dec 30 01:22:09 2021
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Thu Dec 30 01:22:09 2021
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/181847e1ac76e8b26b392cd524100c7b1c0c407e/">
    5fca958db731d2b48d84da9ec1f5618f2f73ff96
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/181847e1ac76e8b26b392cd524100c7b1c0c407e%5E">
    b00d9dcb93a221cd037679c5d473a674c3ab9d88
   </a>
   <span>
    [
    <a href="/chromium/src/+/181847e1ac76e8b26b392cd524100c7b1c0c407e%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table><hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">[Extensions] Disallow paths for scripts with match_origin_as_fallback

Extensions can specify the `match_origin_as_fallback` key in a
content script definition, allowing scripts to inject into frames
where normal URL matching won't work (like about:, data:, blob:,
filesystem:, etc). In these cases, we look at the "precursor origin"
for the frame - that is, the origin of the creator or initiator of
the frame.

However, there is one limitation here. Because we only match origins in
these cases, we cannot sufficiently match the path component of any
script specifications. For instance, consider a content script that
specifies `"matches": ["<a href="https://google.com/maps">https://google.com/maps</a>"]` and
`"match_origin_as_fallback": true`.
A) If we require the pattern to match, the script will never inject on
   frames where we invoke the callback (because there's never a matching
   path component).
B) If we don't require the pattern to match (or the pattern path to
   match), the script will also inject on frames created by
   <a href="https://google.com.">https://google.com.</a>

Neither of these is good, since neither would likely align with
developer expectations (by either never taking into account a property
specified, as in A, or by injecting into unexpected sites, as in B).

Instead, require any content script that specifies
`"match_origin_as_fallback": true` to specify a path of "*" (matching
all paths). This way, the script will only inject on truly matching
sites, and it also makes it clear to developers that they will need
to account for the possibility of the script injecting on frames
created by different properties within the same origin.

Update tests for the same, including removing some API tests that
exercised path-specific behavior (since now scripts that use
match_origin_as_fallback cannot be specified with a path).

Bug: 55084
Change-Id: <a href="https://chromium-review.googlesource.com/#/q/Idf72dce7f43e0673ec40e5667049c3992060ac3e">Idf72dce7f43e0673ec40e5667049c3992060ac3e</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/3354297">https://chromium-review.googlesource.com/c/chromium/src/+/3354297</a>
Reviewed-by: ≈Åukasz Anforowicz &lt;lukasza@chromium.org&gt;
Commit-Queue: Devlin Cronin &lt;rdevlin.cronin@chromium.org&gt;
Cr-Commit-Position: refs/heads/main@{#954534}
</pre>

</body>
</html>
