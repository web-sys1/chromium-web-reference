<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/919696/"> 919696</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/0548dd9d10add21f75e4685e91389ff72dc99a5d">0548dd9d10add21f75e4685e91389ff72dc99a5d</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/919659/">919659</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/b9b5246c9979f763255493910574b5e929fd4b70">b9b5246c9979f763255493910574b5e929fd4b70</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   0548dd9d10add21f75e4685e91389ff72dc99a5d
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/0548dd9d10add21f75e4685e91389ff72dc99a5d">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/0548dd9d10add21f75e4685e91389ff72dc99a5d.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   Anders Hartvoll Ruud &lt;andruud@chromium.org&gt;
  </td>
  <td>
   Thu Sep 09 08:51:35 2021
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Thu Sep 09 08:51:35 2021
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/0548dd9d10add21f75e4685e91389ff72dc99a5d/">
    715ba8ba055f5c79e6d119ea226e20995e87050d
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/0548dd9d10add21f75e4685e91389ff72dc99a5d%5E">
    a02a57f31d42ed604596154ee4e6d16d6f45fe90
   </a>
   <span>
    [
    <a href="/chromium/src/+/0548dd9d10add21f75e4685e91389ff72dc99a5d%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table><hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">[@container] Delayed animation updates

This CL implements a new approach [1][2] for dealing with animated
container queries. The approach can be summarized as:

  1) Delaying application of the CSSAnimationUpdate until after
     layout, and
  2) Remembering the "original" old-styles for relevant elements.

Both of these things were also required for the previous solution
(currently behind the runtime flag CSSIsolatedAnimationUpdates),
so they are already mostly in place. Apart from these two things,
however, the new solution actually has more in common with how
things already work on stable than with CSSIsolatedAnimationUpdates,
so this this CL effectively reverts that code.

The new approach in this CL works like this:

 - During StyleResolver::ResolveStyle, elements that have a non-
   empty animation update gets added to a set on DocumentAnimations.
 - A stack-allocated object CSSAnimationUpdateScope is placed on the
   sites where we do style and layout, and it ensures that any
   collected pending updates are applied before we exit that scope.
 - Old-styles are temporarily added for each element we resolve
   style for, with a lifetime that's also tied to
   CSSAnimationUpdateScope.

Regarding InApplyAnimationUpdateScope: it turns out that applying
an animation update can cause calls to Element::
SetNeedsAnimationStyleRecalc. On main, these calls are ignored,
because we always apply the animation update during style recalc,
and we early-out from SetNeedsAnimationStyleRecalc if we're currently
in style recalc. With the changes in this CL, we apply the same
update *after* style recalc, so we need another way to early-out
from SetNeedsAnimationStyleRecalc, and this is what the
InApplyAnimationUpdateScope is for.

Note: It probably makes sense to store the elements-with-pending-
      updates set and the old-styles on the CSSAnimationUpdateScope
      itself, but I'll try that in a separate CL.
Note: We still store old-styles for way too many elements. An
      improvement for that is coming soon.

[1] <a href="https://docs.google.com/document/d/1Ef9V-Ra_6I3R9DY0o10fZ7HTriPm9oHYw1xUN0bRcHw">https://docs.google.com/document/d/1Ef9V-Ra_6I3R9DY0o10fZ7HTriPm9oHYw1xUN0bRcHw</a>
[2] <a href="https://github.com/w3c/csswg-drafts/issues/6398#issuecomment-904754453">https://github.com/w3c/csswg-drafts/issues/6398#issuecomment-904754453</a>


Change-Id: <a href="https://chromium-review.googlesource.com/#/q/I735b9113c12ef57696b82470b2256c639884ef48">I735b9113c12ef57696b82470b2256c639884ef48</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/3129367">https://chromium-review.googlesource.com/c/chromium/src/+/3129367</a>
Commit-Queue: Anders Hartvoll Ruud &lt;andruud@chromium.org&gt;
Reviewed-by: Rune Lillesveen &lt;futhark@chromium.org&gt;
Reviewed-by: Kevin Ellis &lt;kevers@chromium.org&gt;
Reviewed-by: Xianzhu Wang &lt;wangxianzhu@chromium.org&gt;
Cr-Commit-Position: refs/heads/main@{#919696}
</pre>

</body>
</html>
