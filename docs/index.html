<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/1022090/"> 1022090</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/ba44adbcbf63ee73c814939374f2f475e320324e">ba44adbcbf63ee73c814939374f2f475e320324e</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/1022083/">1022083</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/ca27d6c0397ec9e65a80e81ba2a858e4158c3c06">ca27d6c0397ec9e65a80e81ba2a858e4158c3c06</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   ba44adbcbf63ee73c814939374f2f475e320324e
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/ba44adbcbf63ee73c814939374f2f475e320324e">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/ba44adbcbf63ee73c814939374f2f475e320324e.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   Artem Sumaneev &lt;asumaneev@google.com&gt;
  </td>
  <td>
   Fri Jul 08 10:40:03 2022
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Fri Jul 08 10:40:03 2022
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/ba44adbcbf63ee73c814939374f2f475e320324e/">
    ff3cb01a24fd443b7ce1f8d6602c237f1936c72c
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/ba44adbcbf63ee73c814939374f2f475e320324e%5E">
    b2107b4cdd5f917c6b2f7149211f860b9c4d16ba
   </a>
   <span>
    [
    <a href="/chromium/src/+/ba44adbcbf63ee73c814939374f2f475e320324e%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table><hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">[Enrollment] Add ServerStateAvailabilityRequester helper for
AutoEnrollmentClient.

Add ServerStateAvailabilityRequester helper to AutoEnrollmentClient to
handle server state availability requests of TYPE_AUTO_ENROLLMENT and
TYPE_PSM_HAS_DEVICE_STATE_REQUEST for FRE and Initial Enrollment
correspondingly.

The helpers are specialised for FRE and Initial Enrollment encapsulate
the logic of requesting and parsing response, and storing results.
AutoEnrollmentClient only handles the results.

Notable change is that AutoEnrollmentClient used to cache PSM execution
result in psm_result_holder_ and decided the next step according to the
cache. If execution resulted in an error, the next step was not
performed. Now, instead of the cache, AutoEnrollmentClient checks local
state set by the helper for the same decision in PsmRetryStep.

Once NextStep/RetryStep mechanism is replaced with the state machine,
the client will be asking PsmRlweDmserverClient directly to retry
membership check. The behaviour of not retrying will be preserved as
PsmRlweDmserverClient remembers its last execution result and reports it
instead of a new request.

Bug: chromium:1294843
Test: unit_tests --gtest_filter="*AutoEnrollmentClientImplTest*"
Test: unit_tests --gtest_filter="*AutoEnrollmentClientImplFREToInitialEnrollmentTest*"
Test: unit_tests --gtest_filter="*PsmHelperInitialEnrollmentTest*"
Test: unit_tests --gtest_filter="*PsmHelperInitialEnrollmentInternalErrorTest*"
Test: manual on device
Change-Id: <a href="https://chromium-review.googlesource.com/#/q/Ib82b17e2f0a96807b2bc1bc5194cbc199a1082a4">Ib82b17e2f0a96807b2bc1bc5194cbc199a1082a4</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/3676868">https://chromium-review.googlesource.com/c/chromium/src/+/3676868</a>
Commit-Queue: Artem Sumaneev &lt;asumaneev@google.com&gt;
Reviewed-by: Amr Aboelkher &lt;amraboelkher@chromium.org&gt;
Cr-Commit-Position: refs/heads/main@{#1022090}
</pre>

</body>
</html>
