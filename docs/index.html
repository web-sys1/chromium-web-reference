<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/908367/"> 908367</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/d006c1cf3e44a619029605c609b65c37177d14dc">d006c1cf3e44a619029605c609b65c37177d14dc</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/908380/">908380</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/451d4e2945cbe4e7260de5b0a6c92af65ac7c101">451d4e2945cbe4e7260de5b0a6c92af65ac7c101</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   d006c1cf3e44a619029605c609b65c37177d14dc
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/d006c1cf3e44a619029605c609b65c37177d14dc">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/d006c1cf3e44a619029605c609b65c37177d14dc.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   Matt Falkenhagen &lt;falken@chromium.org&gt;
  </td>
  <td>
   Wed Aug 04 07:50:15 2021
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Wed Aug 04 07:50:15 2021
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/d006c1cf3e44a619029605c609b65c37177d14dc/">
    ad9dc856b04473e05aeb31bd32174ff1ff3ba995
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/d006c1cf3e44a619029605c609b65c37177d14dc%5E">
    69fdfb027861feb139d9b6299ea77d6abf8fca2a
   </a>
   <span>
    [
    <a href="/chromium/src/+/d006c1cf3e44a619029605c609b65c37177d14dc%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table><hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">mparch: Make BackgroundFetch mparch-aware.

Prefer RenderFrameHost to WebContents as there can be multiple main
frames associated with a WebContents.

The code previously used WebContents only for main frames in order to
check permissions for them: BackgroundFetchServiceImpl::CreateForFrame
passed a `wc_getter` to BackgroundFetchServiceImpl's constructor only
for main frames. Later, this `wc_getter` was used in
BackgroundFetchDelegateProxy::GetPermissionForOrigin() to look up the
WebContents, and then call GetPermissionStatusForFrame() on the main
frame of the WebContents.

This CL changes things to pass the RenderFrameHostImpl directly to
BackgroundFetchDelegateProxy::GetPermissionForOrigin(), which calls
GetPermissionStatusForFrame() only if it is a main frame. We *could*
use the RenderFrameHostImpl always, but this would be inconsistent with
the original code.

The code also previously filtered out non top-level frames when
recording UKM. Because the intention appears to be to ensure that the
page displayed to the user is the same as the one that initiated the
background fetch, the UKM code is changed to filter out non-active
render frames as these are not necessarily displayed to the user.

Note that for prerendering, this is all moot, because prerender's Mojo
Capability Control prevents prerendered documents from using background
fetch, and does not create the BackgroundFetchService until after
activation.

Bug: 1061899
Change-Id: <a href="https://chromium-review.googlesource.com/#/q/I6409956ad83728e28db09a505ed99487a3be38b1">I6409956ad83728e28db09a505ed99487a3be38b1</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/3053479">https://chromium-review.googlesource.com/c/chromium/src/+/3053479</a>
Commit-Queue: Matt Falkenhagen &lt;falken@chromium.org&gt;
Reviewed-by: Lucas Gadani &lt;lfg@chromium.org&gt;
Reviewed-by: Alexander Timin &lt;altimin@chromium.org&gt;
Reviewed-by: Rayan Kanso &lt;rayankans@chromium.org&gt;
Cr-Commit-Position: refs/heads/master@{#908367}
</pre>

</body>
</html>
