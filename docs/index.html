<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/935432/"> 935432</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/ba222816ee66526b572f5a78dfc948c8b3af27be">ba222816ee66526b572f5a78dfc948c8b3af27be</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/935421/">935421</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/1a6ba839bca5091dd8811742658cacd550799313">1a6ba839bca5091dd8811742658cacd550799313</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   ba222816ee66526b572f5a78dfc948c8b3af27be
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/ba222816ee66526b572f5a78dfc948c8b3af27be">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/ba222816ee66526b572f5a78dfc948c8b3af27be.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   Benoit Lize &lt;lizeb@chromium.org&gt;
  </td>
  <td>
   Wed Oct 27 15:19:09 2021
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Wed Oct 27 15:19:09 2021
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/ba222816ee66526b572f5a78dfc948c8b3af27be/">
    2b79beb32c19a68b8029c4ae5587d0d9365527b2
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/ba222816ee66526b572f5a78dfc948c8b3af27be%5E">
    ffeffbcb81bca19e49d99b79173765aaf9d0a790
   </a>
   <span>
    [
    <a href="/chromium/src/+/ba222816ee66526b572f5a78dfc948c8b3af27be%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table><hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">[PartitionAlloc] Sort the SlotSpan freelists in PurgeMemory().

To improve cache efficiency and possibly reduce fragmentation as well,
slots to be allocated should be sorted. However this is currently not
the case, as we prefer a Last In First Out (LIFO) ordering, for better
cache locality (since a recently freed allocation is likely still hot in
cache).

These two types of cache locality are not contradictory: allocated
memory from the central allocator should be as contiguous as possible,
and preferably sorted in ascending order (so that newly-allocated memory
looks like a contiguous array), while reused memory should prefer the
most recently used memory. So we want:
- contiguous allocations from the central allocator
- LIFO ordering in the thread cache.

This CL adds a way to sort freelists, but doing it infrequently enough
to not undermine cache locality, hence it is done in PurgeMemory(). Note
that this is not enough, as thread cache batch fill is still
reversed. Also, the end of slot spans are not decommitted, contrary to
what is done for larger bucket sizes (when individual allocations are at
least one page long). This will be explored in forthcoming CLs.

Change-Id: <a href="https://chromium-review.googlesource.com/#/q/Icb93269b6e1eacbefecfd736b7f97bada883c45a">Icb93269b6e1eacbefecfd736b7f97bada883c45a</a>
Bug: 998048
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/3172645">https://chromium-review.googlesource.com/c/chromium/src/+/3172645</a>
Reviewed-by: Bartek Nowierski &lt;bartekn@chromium.org&gt;
Commit-Queue: Benoit L &lt;lizeb@chromium.org&gt;
Cr-Commit-Position: refs/heads/main@{#935432}
</pre>

</body>
</html>
