<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/1005284/"> 1005284</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/37ce788999febde7a5c4360918e41d9ffac7a7da">37ce788999febde7a5c4360918e41d9ffac7a7da</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/1005271/">1005271</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/3b026b27fdc16ca62f0a327d892a8b88c2a5e5d3">3b026b27fdc16ca62f0a327d892a8b88c2a5e5d3</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   37ce788999febde7a5c4360918e41d9ffac7a7da
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/37ce788999febde7a5c4360918e41d9ffac7a7da">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/37ce788999febde7a5c4360918e41d9ffac7a7da.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   Steinar H. Gunderson &lt;sesse@chromium.org&gt;
  </td>
  <td>
   Thu May 19 17:19:18 2022
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Thu May 19 17:19:18 2022
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/37ce788999febde7a5c4360918e41d9ffac7a7da/">
    837ea09e59e87ccb99e68e6193bb3bbb3bb28c0b
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/37ce788999febde7a5c4360918e41d9ffac7a7da%5E">
    5d438af104743bd2d1ba569628297e16c8cc93c1
   </a>
   <span>
    [
    <a href="/chromium/src/+/37ce788999febde7a5c4360918e41d9ffac7a7da%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table><hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">Move CheckPseudoHasCacheScope out of the hot path.

The performance impact is somewhat curious; perf reports that all
of the constructor and destructor (0.73% and 1.60% of runtime,
respectively) goes away, but that there are also large changes in
SelectorChecker, not all of which are positive (e.g., MatchSelector()
gets -2.31% from baseline 7.20%, but CheckOne() gets +3.18% from
baseline 8.63%). This means we get nowhere near the 2% (or more)
that we should have saved, although the benchmarks still show a
win. These are probably ripple effects from different inlining
decisions or code placement, which may or may not be still relevant
with PGO and in an actual browser setting.

Despite the not-hugely-winning benchmark, this should probably
go in, since:

 a) The benchmarks are clearly _not negative_.
 b) The change makes sense.
 c) If just counting instructions, we win about 2.5%, and there
    is no logical reason why the cycle count would show something
    else over time.

Style microbenchmarks (Zen 3, LTO but no PGO):

Initial style (µs)     Before     After    Perf      95% CI (BCa)
=================== ========= ========= ======= =================
ECommerce                7850      7830   +0.3%  [ -0.4%,  +1.3%]
Encyclopedia            78422     78171   +0.3%  [ -0.3%,  +1.0%]
Extension              185779    183640   +1.2%  [ +0.4%,  +2.6%]
News                    32581     32499   +0.3%  [ -0.4%,  +0.9%]
Search                   1925      1898   +1.4%  [ +0.7%,  +2.8%]
Social1                 18914     19063   -0.8%  [ -3.5%,  +0.4%]
Social2                   736       728   +1.1%  [ +0.3%,  +3.3%]
Sports                  27311     26894   +1.6%  [ +0.9%,  +3.0%]
Video                   30565     30535   +0.1%  [ -2.6%,  +1.4%]
Geometric mean                            +0.6%  [ +0.0%,  +1.1%]

Recalc style (µs)      Before     After    Perf      95% CI (BCa)
=================== ========= ========= ======= =================
ECommerce                9861      9786   +0.8%  [ +0.2%,  +1.4%]
Encyclopedia            72303     71854   +0.6%  [ +0.0%,  +1.1%]
Extension              186554    184146   +1.3%  [ +0.7%,  +1.9%]
News                    25298     25266   +0.1%  [ -0.4%,  +0.6%]
Search                    199       196   +1.5%  [ +0.8%,  +3.1%]
Social1                 14051     14197   -1.0%  [ -4.0%,  +0.0%]
Social2                   420       412   +1.7%  [ +1.0%,  +4.4%]
Sports                  22936     22504   +1.9%  [ +1.3%,  +3.3%]
Video                   22326     22293   +0.1%  [ -2.6%,  +2.6%]
Geometric mean                            +0.8%  [ +0.3%,  +1.4%]

Change-Id: <a href="https://chromium-review.googlesource.com/#/q/Ic988c1a2f5bf0b32dab1ef72a8214f2b5ebbe034">Ic988c1a2f5bf0b32dab1ef72a8214f2b5ebbe034</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/3650586">https://chromium-review.googlesource.com/c/chromium/src/+/3650586</a>
Reviewed-by: Anders Hartvoll Ruud &lt;andruud@chromium.org&gt;
Commit-Queue: Steinar H Gunderson &lt;sesse@chromium.org&gt;
Cr-Commit-Position: refs/heads/main@{#1005284}
</pre>

</body>
</html>
