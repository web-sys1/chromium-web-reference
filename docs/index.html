<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/1223115/"> 1223115</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/f92b060ccd2bd19520c27b1b55696d1e149c9e5e">f92b060ccd2bd19520c27b1b55696d1e149c9e5e</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/1223067/">1223067</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/2d7b459c6bd8e03a204afc17888431d41eab08e2">2d7b459c6bd8e03a204afc17888431d41eab08e2</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   f92b060ccd2bd19520c27b1b55696d1e149c9e5e
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/f92b060ccd2bd19520c27b1b55696d1e149c9e5e">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/f92b060ccd2bd19520c27b1b55696d1e149c9e5e.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   manukh &lt;manukh@chromium.org&gt;
  </td>
  <td>
   Fri Nov 10 20:36:34 2023
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Fri Nov 10 20:36:34 2023
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/f92b060ccd2bd19520c27b1b55696d1e149c9e5e/">
    9360d03369f6662f7cb71f65e71bfe1bad314084
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/f92b060ccd2bd19520c27b1b55696d1e149c9e5e%5E">
    f9e451b8d2feef9395d2afcf7af4667751409305
   </a>
   <span>
    [
    <a href="/chromium/src/+/f92b060ccd2bd19520c27b1b55696d1e149c9e5e%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table>
<hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">[omnibox][ml] Redistribute shortcut boosting

ML scoring redistribute the traditional scores of the ML-scored
suggestions. The goal was to keep the balance between ML-scored and
non-ML-scored suggestions and avoid search regressions.

This CL makes ML scoring also redistribute the `shortcut_boosted` field
to the highest ML scored suggestions. The goal is the same; since this
field also affects ranking, we want to keep the same before/after
balance.

E.g., if we had this traditional ranking:
- shortcut 1, 1416 boosted defaultable
- shortcut 2, 1415 boosted defaultable
- search 1,   1300         defaultable
- search 2,   800
- url 3,      1414         defaultable
- url 4,      1200
- url 5,      600

Then before this CL, ML might give:
- url 3,      1414         defaultable
- search 1,   1300         defaultable
- shortcut 1, 1200 boosted defaultable
- search 2,   800
- shortcut 2, 600  boosted defaultable
- url 4,      1400
- url 5,      1416

That's bad because a) we broke search grouping, and b) search ranking
wasn't held constant. Also, in other examples, c) we might be changing
the default suggestion from a shortcut to a search.

With this CL, ML would instead give:
- url 3,      1414 boosted defaultable
- url 5,      1416 boosted
- search 1,   1300         defaultable
- search 2,   800
- url 4,      1400
- shortcut 1, 1200         defaultable
- shortcut 2, 600          defaultable

This keeps the same search v non-search rankings in this example.

This isn't a complete solution. There's still cases (both with and
without shortcut boosting) where ML will change the default suggestion
from non-search to search or vice versa or increase the # of URLs
grouped above searches. See the test for examples. That's an issue
regardless of shortcut boosting. We'll do a more robust fix as a
followup.

Bug: 1405555
Change-Id: <a href="https://chromium-review.googlesource.com/#/q/I0caea96ffdb01899d987ba13e19ef996ec51b013">I0caea96ffdb01899d987ba13e19ef996ec51b013</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/5018417">https://chromium-review.googlesource.com/c/chromium/src/+/5018417</a>
Reviewed-by: Angela Yoeurng &lt;yoangela@chromium.org&gt;
Commit-Queue: Angela Yoeurng &lt;yoangela@chromium.org&gt;
Auto-Submit: manuk hovanesian &lt;manukh@chromium.org&gt;
Code-Coverage: findit-for-me@appspot.gserviceaccount.com &lt;findit-for-me@appspot.gserviceaccount.com&gt;
Commit-Queue: manuk hovanesian &lt;manukh@chromium.org&gt;
Cr-Commit-Position: refs/heads/main@{#1223115}
</pre>

</body>
</html>
