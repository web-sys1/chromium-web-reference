<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/925955/"> 925955</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/ad27452027b357dd2f642b1c351d4f5c2b98d662">ad27452027b357dd2f642b1c351d4f5c2b98d662</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/925964/">925964</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/0c68bdbd673c6ccd6c087a112d24800fe4c691ce">0c68bdbd673c6ccd6c087a112d24800fe4c691ce</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   ad27452027b357dd2f642b1c351d4f5c2b98d662
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/ad27452027b357dd2f642b1c351d4f5c2b98d662">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/ad27452027b357dd2f642b1c351d4f5c2b98d662.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   Andrew Paseltiner &lt;apaseltiner@chromium.org&gt;
  </td>
  <td>
   Tue Sep 28 21:44:43 2021
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Tue Sep 28 21:44:43 2021
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/ad27452027b357dd2f642b1c351d4f5c2b98d662/">
    a0bf0fc293c8cb2bda9bf633046d2497dc91bf4b
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/ad27452027b357dd2f642b1c351d4f5c2b98d662%5E">
    f96b62edc6764b85e84aacdd5fecaf1c28d7635e
   </a>
   <span>
    [
    <a href="/chromium/src/+/ad27452027b357dd2f642b1c351d4f5c2b98d662%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table><hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">[attribution_reporting] Prevent erroneous deletion of reports removed from queue

Without this change, the reporter invokes the manager's OnReportSent
callback with kDropped, which causes the manager to delete the
associated report from storage. For reports that were actually deleted
by ConversionStorage::ClearData this is redundant but safe, but for
reports that were pessimistically removed from the queue but not
actually deleted, this wrongly causes the report to be deleted in
ConversionManagerImpl::OnReportSent.

This was an oversight in crrev.com/c/3071159 which may have been
prevented if the ConversionManagerImpl unit tests used a real reporter
instead of a mock one, since I made the mock's implementation of
RemoveAllReportsFromQueue a no-op.

We fix this by distinguishing kDropped from kRemovedFromQueue and
changing the mock reporter to call OnReportSent with the latter.

Bug: 1073070, 1253979
Change-Id: <a href="https://chromium-review.googlesource.com/#/q/Iec98f68e7289d5d33f5d13298d847d3cc30fe427">Iec98f68e7289d5d33f5d13298d847d3cc30fe427</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/3190410">https://chromium-review.googlesource.com/c/chromium/src/+/3190410</a>
Commit-Queue: Andrew Paseltiner &lt;apaseltiner@chromium.org&gt;
Reviewed-by: John Delaney &lt;johnidel@chromium.org&gt;
Cr-Commit-Position: refs/heads/main@{#925955}
</pre>

</body>
</html>
