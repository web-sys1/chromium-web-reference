<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/1022578/"> 1022578</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/0c3550f93f7a47948a6f397b5f53215a1122e691">0c3550f93f7a47948a6f397b5f53215a1122e691</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/1022568/">1022568</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/842eb62fb1ca20fff8b094c172d66574b97e8746">842eb62fb1ca20fff8b094c172d66574b97e8746</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   0c3550f93f7a47948a6f397b5f53215a1122e691
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/0c3550f93f7a47948a6f397b5f53215a1122e691">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/0c3550f93f7a47948a6f397b5f53215a1122e691.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   Aaron Leventhal &lt;aleventhal@google.com&gt;
  </td>
  <td>
   Mon Jul 11 05:04:14 2022
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Mon Jul 11 05:04:14 2022
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/0c3550f93f7a47948a6f397b5f53215a1122e691/">
    71aaccc6499786ec2a77593be6c0b92d31063fbc
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/0c3550f93f7a47948a6f397b5f53215a1122e691%5E">
    6bbd003a76a612232cb830ecbb6e7105fabd5680
   </a>
   <span>
    [
    <a href="/chromium/src/+/0c3550f93f7a47948a6f397b5f53215a1122e691%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table><hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">Reland: Do not fire events in detached child frames

Original: CL:3727378
Revert: CL:3700452
Reason for revert: crbug.com/1342326,crbug.com/1342425 (sometimes
load complete events could be dropped, causing failing tests)

Only fire events on nodes that in documents that are attached
to the root document of the a11y tree. Child trees will begin firing events as soon as all of their parent documents are serialized.
This prevents a bug in AppKit that causes VoiceOver to get stuck repeating "not responding" messages. The bug goes away as long as
events are only fired on objects that are attached to the root.

We had the same bug in Views, and it was fixed in CL:3595084.
One of the bugs listed in the CL description is bug 1221262, which refers to getting stuck saying "busy busy busy", that was the previous message that VoiceOver would speak -- "[appname] is not responding" appears to be the same issue.

Also enforces tree relationship rules via additional CHECKs/DCHECKs.

This CL currently applies only to non-Chrome OS web contents. For it to generalize to other trees not based on BrowserAccessibilityManager including all of Chrome OS, views, and others, we will need to bubble
the logic up to ui/accessibility (AXTreeManagerBase).
So, this should be an intermediate state until we can get AXTreeManager in as a base concrete class e.g. CL:3646162.

Follow-ups:
- Notify Apple of issue and workaround
- Consider not generating events when CanFireEvents() returns false.
  See CL:3726240
- Look into bfcache/focus check failure. See TODO in
  BrowserAccessibilityManager::GetLastFocusedNode()
- Do not use/allow null delegates in BrowserAccessibilityManager (currently a workaround for unit tests): crbug.com/1340004
- Explore whether Mac a11y still needs separate concept of ignored nodes: crbug.com/1339975
- Clarify child tree serialization rules (CL:3727378)
- Look into whether order of iframe serialization can be enforced to be parents first. See CL:3731609.
- Try to remove generated load complete events as they are redundant
  with Blink load complete events (crbug.com/1342649)
- Move logic to AXTreeManagerBase

Bug: 1311759
Test: <a href="https://github.com/password_reset">https://github.com/password_reset</a>
Change-Id: <a href="https://chromium-review.googlesource.com/#/q/I4337e731632427c11f776d3a351cd674ae655501">I4337e731632427c11f776d3a351cd674ae655501</a>
AX-RelNotes: potential fix for issue where VoiceOver gets stuck saying "Chrome is not responding" repeatedly.
Cq-Include-Trybots: luci.chromium.try:linux-blink-web-tests-force-accessibility-rel
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/3700452">https://chromium-review.googlesource.com/c/chromium/src/+/3700452</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/3750239">https://chromium-review.googlesource.com/c/chromium/src/+/3750239</a>
Reviewed-by: Nektarios Paisios &lt;nektar@chromium.org&gt;
Commit-Queue: Nektarios Paisios &lt;nektar@chromium.org&gt;
Auto-Submit: Aaron Leventhal &lt;aleventhal@chromium.org&gt;
Cr-Commit-Position: refs/heads/main@{#1022578}
</pre>

</body>
</html>
