<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/992166/"> 992166</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/ab53cd28eb8ac55c8d837d1a253c4a595bc3370d">ab53cd28eb8ac55c8d837d1a253c4a595bc3370d</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/992151/">992151</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/57715bc35db96740f6981d44afb87aafd8e8007a">57715bc35db96740f6981d44afb87aafd8e8007a</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   ab53cd28eb8ac55c8d837d1a253c4a595bc3370d
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/ab53cd28eb8ac55c8d837d1a253c4a595bc3370d">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/ab53cd28eb8ac55c8d837d1a253c4a595bc3370d.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   Hiroki Nakagawa &lt;nhiroki@chromium.org&gt;
  </td>
  <td>
   Wed Apr 13 19:18:02 2022
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Wed Apr 13 19:18:02 2022
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/ab53cd28eb8ac55c8d837d1a253c4a595bc3370d/">
    fdacc58343f7962aae82e87ae4522aa7e9af0c0d
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/ab53cd28eb8ac55c8d837d1a253c4a595bc3370d%5E">
    020b46d3bb62cd852396fe76fe6842a04cb5ed4d
   </a>
   <span>
    [
    <a href="/chromium/src/+/ab53cd28eb8ac55c8d837d1a253c4a595bc3370d%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table><hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">Prerender: Update sticky user activation during prerender activation

This CL fixes the DCHECK failure caused by discrepancy of
FrameReplicationState::has_received_user_gesture_before_nav between
prerender initial navigation and prerender activation navigation.

&gt; High-level context

Prerender runs navigations twice: navigation for prerendering a page
(prerender initial navigation), and navigation for displaying the
prerendered page (prerender activation navigation), like BFCache. These
navigations are required to have the same navigation params for
consistency, but currently has_received_user_gesture_before_nav on
FrameReplicationState doesn't satisfy this requirement as the prerender
initial navigation should never have the user activation but the
prerender activation navigation may have it. This CL fixes the
discrepancy by adjusting the param during the activation navigation.

&gt; How is the param treated on regular navigation?

On regular navigation, has_received_user_gesture_before_nav on
FrameReplicationState is updated via a renderer =&gt; browser IPC
(RenderFrameHostImpl::HadStickyUserActivationBeforeNavigationChanged),
which is sent from blink::DocumentLoader::CommitNavigation in the
renderer. However, this doesn't happen on prerender page activation, so
the value is not correctly updated.

&gt; How does this CL fix it?

This CL explicitly updates the param during the activation navigation
and propagates it to the prerendered page to be activated in a renderer.


[Credit] A part of this change was originally written by
hbolaria@google.com.

Bug: 1268294
Change-Id: <a href="https://chromium-review.googlesource.com/#/q/I89452babf16eec3ecb67af20de109c9d6a52ca9a">I89452babf16eec3ecb67af20de109c9d6a52ca9a</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/3461077">https://chromium-review.googlesource.com/c/chromium/src/+/3461077</a>
Reviewed-by: Harkiran Bolaria &lt;hbolaria@google.com&gt;
Reviewed-by: Alexander Timin &lt;altimin@chromium.org&gt;
Reviewed-by: Daniel Cheng &lt;dcheng@chromium.org&gt;
Reviewed-by: Rakina Zata Amni &lt;rakina@chromium.org&gt;
Reviewed-by: Mustaq Ahmed &lt;mustaq@chromium.org&gt;
Commit-Queue: Hiroki Nakagawa &lt;nhiroki@chromium.org&gt;
Cr-Commit-Position: refs/heads/main@{#992166}
</pre>

</body>
</html>
