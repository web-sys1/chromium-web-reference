<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/916300/"> 916300</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/e2a255b5efe2190dc29e52671f6155b96a7a19bc">e2a255b5efe2190dc29e52671f6155b96a7a19bc</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/916300/">916300</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/e2a255b5efe2190dc29e52671f6155b96a7a19bc">e2a255b5efe2190dc29e52671f6155b96a7a19bc</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   e2a255b5efe2190dc29e52671f6155b96a7a19bc
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/e2a255b5efe2190dc29e52671f6155b96a7a19bc">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/e2a255b5efe2190dc29e52671f6155b96a7a19bc.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   Alexey Baskakov &lt;loyso@chromium.org&gt;
  </td>
  <td>
   Mon Aug 30 02:26:59 2021
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Mon Aug 30 02:26:59 2021
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/e2a255b5efe2190dc29e52671f6155b96a7a19bc/">
    b8393f32c423344596d3925f2f053689c2affd9b
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/e2a255b5efe2190dc29e52671f6155b96a7a19bc%5E">
    1dacbcad9786e04459c4b65766588e4e34cf5ca2
   </a>
   <span>
    [
    <a href="/chromium/src/+/e2a255b5efe2190dc29e52671f6155b96a7a19bc%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table><hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">dpwa: Avoid overwriting manifest fields if web app already exists.

Background:
The same web app can be installed and uninstalled by a number
of systems (multiple sources). We add an extra source and
update the web app manifest and icons if the app already exists.

kWebAppStore and kDefault install sources provide an offline
manifest fields, which may represent a subset or out-of-date
fields from the real web site's manifest.

The problem:
If the already existing app is installed by a user or sync
(the app has fresh manifest fields from online) then
its data gets overwritten by fallback manifest data,
including sync_fallback_data (sync_fallback_data is empty
for kWebAppStore and kDefault install sources).
As a result, we upload empty sync_fallback_data to the sync
server and then it gets replicated as empty to all synced
devices.

The fix:
Introduce overwrite_existing_manifest_fields flag in InstallParams
to denote that a call site prefers fresh existing manifest
fields.

This CL plumbs `force_reinstall` from ExternalInstallOptions to
WebAppInstallParams as is.

Alternative approach considered but rejected:
<a href="https://chromium-review.googlesource.com/c/chromium/src/+/3096397">https://chromium-review.googlesource.com/c/chromium/src/+/3096397</a>

In next CLs: add more tests for multiple sources situations in
various systems.

Bug: 1238622
Change-Id: <a href="https://chromium-review.googlesource.com/#/q/I4912c230d961de9bbd4ca291889b1ec305ba7dc7">I4912c230d961de9bbd4ca291889b1ec305ba7dc7</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/3097263">https://chromium-review.googlesource.com/c/chromium/src/+/3097263</a>
Commit-Queue: Alexey Baskakov &lt;loyso@chromium.org&gt;
Reviewed-by: Alan Cutter &lt;alancutter@chromium.org&gt;
Reviewed-by: Marc Treib &lt;treib@chromium.org&gt;
Reviewed-by: Reilly Grant &lt;reillyg@chromium.org&gt;
Reviewed-by: Tim Sergeant &lt;tsergeant@chromium.org&gt;
Cr-Commit-Position: refs/heads/main@{#916300}
</pre>

</body>
</html>
