<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/1247715/"> 1247715</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/8d35771ea27340b685d70816fd1839ceae9a6b49">8d35771ea27340b685d70816fd1839ceae9a6b49</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/1247708/">1247708</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/23e51f4e74aa2a080d30e6be9fa8a9a4f2e7f902">23e51f4e74aa2a080d30e6be9fa8a9a4f2e7f902</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   8d35771ea27340b685d70816fd1839ceae9a6b49
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/8d35771ea27340b685d70816fd1839ceae9a6b49">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/8d35771ea27340b685d70816fd1839ceae9a6b49.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   manukh &lt;manukh@chromium.org&gt;
  </td>
  <td>
   Tue Jan 16 20:58:56 2024
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Tue Jan 16 20:58:56 2024
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/8d35771ea27340b685d70816fd1839ceae9a6b49/">
    d170f7ade5cf8a2e410c6230786d432794bcc827
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/8d35771ea27340b685d70816fd1839ceae9a6b49%5E">
    d006ddf91f9098074f0e2eeae656911628b65a20
   </a>
   <span>
    [
    <a href="/chromium/src/+/8d35771ea27340b685d70816fd1839ceae9a6b49%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table>
<hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">[omnibox][ml] Search blending &amp; don't force keywords to be default.

`kForceAllowedToBeDefault` attempted to allow all matches to be
inlineable. In the short term, this is for fishfooding. Though long
term, we might consider experimenting with removing/adjusting the
multiple ranking adjustments.

Ranking today is determined not only by scores (traditional or ML), but
also other constraints like:
- allowed to be default
- preserving the default match
- search grouping
- boosting
- transferred matches

We've tuned over the years the final ranking to look good. But it's
likley ranking without these contraints would expose some problematic
cases. I.e. these constraints act like crutches. E.g., if HQP matches
are generally scored too high, it won't affect metrics and our
perception much because the allowed to be default constraint will
prevent them from being defaulted anyways.

Likewise, this makes it hard to evaluate ML ranking. Inputs for which ML
does worse (or better) than traditional ranking can go unnoticed if the
additional constraints are making the shown ranking deviate from the
pure score ranking. This also constrain the ML model's potential, even
if we have a perfect ML model, if the matches can't be shown in their
optimal order.

All that background aside, this CL is pretty small:

1) Excludes keyword matches from `kForceAllowedToBeDefault`. Otherwise,
   inputs like 'github.com&lt;enter&gt;' would do a google search for
   'ithub.com' because 'g' would enter keyword mode.

2) Adds a param to ignore the search v URL balance we currently try to
   maintain. When enabled, we simply linearly scale the ML scores from
   [0, 1] to, e.g., [600, 2800] and let normal ranking and culling
   decide how many searches should be shown, whether the default should
   be a search or URL, etc. Shortcut boosting is also no longer kept
   constant; URLs are grouped above searches if they score above a
   certain threshold. We can tune the scaling so that the overall search
   balance is maintained and metrics don't regress. Like above,
   hopefully, this will make good/bad ML cases easier to spot.

3. Re-adds `RecordAdditionalInfo()` for "ml legacy relevance" &amp; "ml
   model output" which were accidentally removed in one of the recent
   refactor CLs.

Bug: 1405555
Change-Id: <a href="https://chromium-review.googlesource.com/#/q/I7f7a200524a257649c6d3e7afebf3b7633138344">I7f7a200524a257649c6d3e7afebf3b7633138344</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/5185583">https://chromium-review.googlesource.com/c/chromium/src/+/5185583</a>
Code-Coverage: findit-for-me@appspot.gserviceaccount.com &lt;findit-for-me@appspot.gserviceaccount.com&gt;
Commit-Queue: manuk hovanesian &lt;manukh@chromium.org&gt;
Reviewed-by: Angela Yoeurng &lt;yoangela@chromium.org&gt;
Cr-Commit-Position: refs/heads/main@{#1247715}
</pre>

</body>
</html>
