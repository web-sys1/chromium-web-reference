<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/943707/"> 943707</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/f42c51c8ca04cb192cf2a54e9888db6cabc041ee">f42c51c8ca04cb192cf2a54e9888db6cabc041ee</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/943700/">943700</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/498d89459a07d2e829893e85fc7d1ccca388bbb1">498d89459a07d2e829893e85fc7d1ccca388bbb1</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   f42c51c8ca04cb192cf2a54e9888db6cabc041ee
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/f42c51c8ca04cb192cf2a54e9888db6cabc041ee">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/f42c51c8ca04cb192cf2a54e9888db6cabc041ee.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   Gabriel Charette &lt;gab@chromium.org&gt;
  </td>
  <td>
   Fri Nov 19 22:54:41 2021
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Fri Nov 19 22:54:41 2021
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/f42c51c8ca04cb192cf2a54e9888db6cabc041ee/">
    e37b638afdb38e2711d520ecab572c7904da51cd
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/f42c51c8ca04cb192cf2a54e9888db6cabc041ee%5E">
    475753900d344820f7c5d47094e4137e9e73e7b0
   </a>
   <span>
    [
    <a href="/chromium/src/+/f42c51c8ca04cb192cf2a54e9888db6cabc041ee%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table><hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">[base] BrowserTaskEnvironment should destroy ThreadPoolInstance before SequenceManagerImpl

This is critical for <a href="https://crrev.com/c/3282499">https://crrev.com/c/3282499</a> where ThreadPool
worker threads can invoke SequenceManagerImpl* and having
~BrowserTaskEnvironment() destroy sequence_manager_ ahead of
DestroyThreadPool() (~TaskEnvironment) was causing a data race:
crbug.com/1270221.

ASAN called out a leak in DeviceService with this change because it
relied on ThreadPool still being alive during ~DeviceService which
posts DeleteSoon to clean additional state. ~DeviceService being
triggered from cleaning SequenceLocalStorage on ~SequenceManagerImpl,
that assumption breaks with this CL.
The fix is to DeleteSoon manually when DeleteSoon fails (ThreadPool
is already shutdown).
This could be problematic with SequenceChecker checks in the deleted
state but there isn't currently any. The long-term solution is to
allow SequenceChecker checks to pass on the main thread after the
associated sequence is shutdown.

Bug: 1263149, 1148010
Fixed: 1270221
Change-Id: <a href="https://chromium-review.googlesource.com/#/q/I3224094ee7fac46ece359a4018dd06733f42b588">I3224094ee7fac46ece359a4018dd06733f42b588</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/3283743">https://chromium-review.googlesource.com/c/chromium/src/+/3283743</a>
Commit-Queue: Gabriel Charette &lt;gab@chromium.org&gt;
Reviewed-by: Reilly Grant &lt;reillyg@chromium.org&gt;
Reviewed-by: Fran√ßois Doray &lt;fdoray@chromium.org&gt;
Cr-Commit-Position: refs/heads/main@{#943707}
</pre>

</body>
</html>
