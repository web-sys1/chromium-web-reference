<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/1040435/"> 1040435</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/9359af686b52fb0b2b3c1009cb6fa3234e44cef3">9359af686b52fb0b2b3c1009cb6fa3234e44cef3</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/1040381/">1040381</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/74d15ab6e415281b70207dcac75a83c9d2bd0f04">74d15ab6e415281b70207dcac75a83c9d2bd0f04</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   9359af686b52fb0b2b3c1009cb6fa3234e44cef3
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/9359af686b52fb0b2b3c1009cb6fa3234e44cef3">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/9359af686b52fb0b2b3c1009cb6fa3234e44cef3.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   Colin Blundell &lt;blundell@chromium.org&gt;
  </td>
  <td>
   Mon Aug 29 15:21:16 2022
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Mon Aug 29 15:21:16 2022
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/9359af686b52fb0b2b3c1009cb6fa3234e44cef3/">
    a9db28515f078aa3b229879ecb8e2c2fc0587daa
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/9359af686b52fb0b2b3c1009cb6fa3234e44cef3%5E">
    c217b182106b69e6e711a93dab158c72d81e4358
   </a>
   <span>
    [
    <a href="/chromium/src/+/9359af686b52fb0b2b3c1009cb6fa3234e44cef3%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table><hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">[Graphics] Mark StreamTextureSII's GLImage as bound when binding

The goal of this CL is to eliminate the GL command decoders' thinking
that StreamTextureSharedImageInterface instances need lazy binding when
clients have correctly called BeginSharedImageAccessDirectCHROMIUM()
before invoking drawing operations. Currently, the SharedImageBacking
subclass that sets the StreamTextureSII instance in the texture [1] does
not mark it as bound in BeginAccess(), so the decoders are not aware
that the images have been bound.

This CL adds such marking. However, it turns out that that is not
enough: the two subclasses of StreamTextureSII currently each override
HasMutableState() to return false, which means that TextureManager
short-circuits out of actually updating its binding state for the
image. This was implemented to ensure that copies of the image are
not mistakenly elided when one of these subclasses is reused with a
different buffer. In StreamTexture, both CopyTexImage() and
BindTexImage() are effectively no-ops, meaning that the semantic change
doesn't actually matter. In CodecImage this is not the case. To ensure
that the necessary semantics here are preserved, this CL also sets
the image state to be unbound in the SharedImageBacking sublasses'
implementations of EndAccess(). We do not believe that CodecImage
will have its associated buffer changed while a client is accessing
it (i.e., in between a call to BeginAccess() and a call to EndAccess()).

Note: It is possible to see the impact of this change on lazy binding
in tests by viewing the trybot results on PS3 and PS8:

- PS3 has CHECKs inserted where the decoders do lazy binding. Android
  test failures are due to this issue.
- PS8 keeps the CHECKs and adds the production fix in this CL. All of
  the Android test failures disappear.

[1] <a href="https://source.chromium.org/chromium/chromium/src/+/main:gpu/command_buffer/service/shared_image/video_surface_texture_image_backing.cc;drc=db0d32ea0c658e4744009d0935d3da0d8b5e7b0a;l=191">https://source.chromium.org/chromium/chromium/src/+/main:gpu/command_buffer/service/shared_image/video_surface_texture_image_backing.cc;drc=db0d32ea0c658e4744009d0935d3da0d8b5e7b0a;l=191</a>

Bug: 1345585
Change-Id: <a href="https://chromium-review.googlesource.com/#/q/I3434bd82dc7b76d01872414aa7232dd870d1cd8c">I3434bd82dc7b76d01872414aa7232dd870d1cd8c</a>
Cq-Do-Not-Cancel-Tryjobs: true
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/3790843">https://chromium-review.googlesource.com/c/chromium/src/+/3790843</a>
Reviewed-by: vikas soni &lt;vikassoni@chromium.org&gt;
Reviewed-by: Sunny Sachanandani &lt;sunnyps@chromium.org&gt;
Reviewed-by: Vasiliy Telezhnikov &lt;vasilyt@chromium.org&gt;
Reviewed-by: Frank Liberato &lt;liberato@chromium.org&gt;
Commit-Queue: Colin Blundell &lt;blundell@chromium.org&gt;
Cr-Commit-Position: refs/heads/main@{#1040435}
</pre>

</body>
</html>
