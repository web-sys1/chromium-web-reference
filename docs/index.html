<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/1114029/"> 1114029</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/8c9b9de4bc98347acaed14aa8247571a83b28d27">8c9b9de4bc98347acaed14aa8247571a83b28d27</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/1113955/">1113955</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/620bd436460c5f0eefa23f982c1653d0ae0ee03f">620bd436460c5f0eefa23f982c1653d0ae0ee03f</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   8c9b9de4bc98347acaed14aa8247571a83b28d27
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/8c9b9de4bc98347acaed14aa8247571a83b28d27">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/8c9b9de4bc98347acaed14aa8247571a83b28d27.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   Elie Maamari &lt;emaamari@google.com&gt;
  </td>
  <td>
   Tue Mar 07 17:53:13 2023
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Tue Mar 07 17:53:13 2023
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/8c9b9de4bc98347acaed14aa8247571a83b28d27/">
    6c8d0cf6e1387d91085393070f99aa98ac645e0d
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/8c9b9de4bc98347acaed14aa8247571a83b28d27%5E">
    ec55e14c42de94c898c4227ec47fc7444460e858
   </a>
   <span>
    [
    <a href="/chromium/src/+/8c9b9de4bc98347acaed14aa8247571a83b28d27%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table><hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">User directory integrity manager fixes

This CL fixes some behaviors discovered during testing of misconfigured
user removal.

- Even though we marked the user in local state as being misconfigured,
and thus they don't show up on the login screen due to filtering in
`user_manager`, the user's cryptohome was not being removed from disk.
This is because the removal was triggered after returning from
`ChromeSessionManager::Initialize`, and thus we were not going through
that codepath at all. This CL moves the call site to before starting the
session.
- Instead of trying to clear prefs and remove user's cryptohome on our
own, we instead call the code that is normally called as part of user
removal, with some modifications to make sure that certain prefs are
indeed cleared for misconfigured users.

Bug: b:239420309
Change-Id: <a href="https://chromium-review.googlesource.com/#/q/Icbb4a961124ba16c29f90af9a1ac2f484531d2ec">Icbb4a961124ba16c29f90af9a1ac2f484531d2ec</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/4171843">https://chromium-review.googlesource.com/c/chromium/src/+/4171843</a>
Reviewed-by: Denis Kuznetsov &lt;antrim@chromium.org&gt;
Reviewed-by: Xiyuan Xia &lt;xiyuan@chromium.org&gt;
Commit-Queue: Elie Maamari &lt;emaamari@google.com&gt;
Reviewed-by: Maksim Ivanov &lt;emaxx@chromium.org&gt;
Cr-Commit-Position: refs/heads/main@{#1114029}
</pre>

</body>
</html>
