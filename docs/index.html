<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/1024614/"> 1024614</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/d19b3e76906eee92dff565506231c28992b5894f">d19b3e76906eee92dff565506231c28992b5894f</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/1024614/">1024614</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/d19b3e76906eee92dff565506231c28992b5894f">d19b3e76906eee92dff565506231c28992b5894f</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   d19b3e76906eee92dff565506231c28992b5894f
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/d19b3e76906eee92dff565506231c28992b5894f">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/d19b3e76906eee92dff565506231c28992b5894f.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   manukh &lt;manukh@chromium.org&gt;
  </td>
  <td>
   Fri Jul 15 06:54:09 2022
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Fri Jul 15 06:54:09 2022
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/d19b3e76906eee92dff565506231c28992b5894f/">
    5fd09fc24b678ad5f3037597c797e203a30b95b3
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/d19b3e76906eee92dff565506231c28992b5894f%5E">
    21a57b38aa5118b5f1fbe29d607cc1678a702ef3
   </a>
   <span>
    [
    <a href="/chromium/src/+/d19b3e76906eee92dff565506231c28992b5894f%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table><hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">[reland][omnibox] Capture escape keys when popup is open.

Relands crrev.com/c/3761156 .
Which was reverted with crrev.com/c/3762407 due to
linux-chromeos-chrome bot failure.
The bot failure is fixed by explicitly enabling a feature in the failing
test. Maybe, field_trial_config.json wasn't sufficient for some reason?

Currently, the omnibox captures the escape key only when input is in
progress, but not when the popup is open without input.

(The popup being open also means the omnibox has focus. If the omnibox
loses focus, the popup is closed.)

Therefore, when both the omnibox popup and find dialog are open, without
omnibox input, escape closes the find dialog rather than the omnibox
popup. A 2nd escape then closes the popup.

This CL changes the omnibox to capture escape when either the input is
in progress OR (it is focused AND the kBlurWithEscape feature is
enabled).

This fix is limited to when the kBlurWithEscape feature is enabled,
because, otherwise, the omnibox never loses focus and indefinitely
captures escape presses. That may still be better than current behavior,
but it's less clear.

This has multiple benefits:

1) It makes the escape handling consistent between zero-suggest and
   non-0-suggest.
   - Before, with 0-suggest and an omnibox selection, 1st the selection
     would be cleared, then find closed, then the omnibox closed.
   - Before, with non-0-suggest and an omnibox selection, 1st the
     selection would be cleared, then the omnibox closed, then find
     closed.
   - With this CL, in both 0 and non-0, 1st the selection is closed,
     then the omnibox closed, then the omnibox blurred, then find
     closed.

2) It makes omnibox-v-find order consistent.
   - Before, sometimes find was closed before the omnibox (e.g. with no
     user input).
   - Before, sometimes find was closed after the omnibox (e.g. with user
     input).
   - Before, sometimes find was interleaved between omnibox actions
     (e.g. with an omnibox selection).
   - With this CL, find is always last.

Exhaustively, the following documents ordering for all combinations of:
before/after this CL; with kBlurWithEscape enabled/disabled; with 0 and
non-0-suggest; and with neither, either, or both omnibox input and
selection:

Before CL
  Feature disabled
    0-suggest
      no input = find, popup
      input = input + popup, find
      selection = selection, find, popup
      input + selection = selection, input + popup, find
    non-0-suggest
      no input = find, elide
      input = input + popup, find
      selection = selection, popup, find
      input+selection = selection, input + popup, find
  kBlurWithEscape enabled
    0-suggest
      no input = find, popup, blur
      input = input + popup, find, blur
      selection = selection, find, popup, blur
      input + selection = selection, input + popup, find, blur
    non-0-suggest
      no input = find, blur
      input = input + popup, find, blur
      selection = selection, popup, find, blur
      input+selection = selection, input + popup, find, blur
With CL
  kBlurWithEscape disabled
    0-suggest
      no input = find, popup
      input = input + popup, find
      selection = selection, find, popup
      input + selection = selection, input + popup, find
    non-0-suggest (same as before patch)
      no input = find, elide
      input = input + popup, find
      selection = selection, popup, find
      input+selection = selection, input + popup, find
  kBlurWithEscape enabled
    0-suggest
      no input = popup, blur, find
      input = input + popup, blur, find
      selection = selection, popup, blur, find
      input + selection = selection, input + popup, blur, find
    non-0-suggest
      no input = popup, blur, find
      input = input + popup, blur, find
      selection = selection, popup, blur, find
      input + selection = selection, input + popup, blur, find

Bug: 776080, 935157
Change-Id: <a href="https://chromium-review.googlesource.com/#/q/I0d4418bedf77b78757a497a84ef57dce17102665">I0d4418bedf77b78757a497a84ef57dce17102665</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/3763500">https://chromium-review.googlesource.com/c/chromium/src/+/3763500</a>
Reviewed-by: Peter Kasting &lt;pkasting@chromium.org&gt;
Commit-Queue: manuk hovanesian &lt;manukh@chromium.org&gt;
Cr-Commit-Position: refs/heads/main@{#1024614}
</pre>

</body>
</html>
