<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/1126400/"> 1126400</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/2a76cd6c96a1828d389dac2ebc8da233753ad539">2a76cd6c96a1828d389dac2ebc8da233753ad539</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/1126388/">1126388</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/baeb1a4e49eaec6caf259c0d08f531d6fea6d6b6">baeb1a4e49eaec6caf259c0d08f531d6fea6d6b6</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   2a76cd6c96a1828d389dac2ebc8da233753ad539
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/2a76cd6c96a1828d389dac2ebc8da233753ad539">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/2a76cd6c96a1828d389dac2ebc8da233753ad539.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   Lingqi Chi &lt;lingqi@chromium.org&gt;
  </td>
  <td>
   Wed Apr 05 03:40:09 2023
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Wed Apr 05 03:40:09 2023
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/2a76cd6c96a1828d389dac2ebc8da233753ad539/">
    1aeae43fa840ff525fba69177f42164aa9e79153
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/2a76cd6c96a1828d389dac2ebc8da233753ad539%5E">
    bb9d0dbf6e009c804763e990d5cf50e9046f92e6
   </a>
   <span>
    [
    <a href="/chromium/src/+/2a76cd6c96a1828d389dac2ebc8da233753ad539%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table><hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">Reland "Reland "SearchPre: [4.2]Add final status metrics for response reader""

This is a reland of commit 23fe1793c1bdb675f21ead8111d1be9c7d590c37

If the prerender host is destroyed before the reader finished serving,
the reader may still be alive when it received the last bytes.
In this case, the completed status would be recorded.
Since the last byte can arrive before and after prerender destruction
in the real world, maybe we can just check whether kCompleted or
kServingError is recorded.

Original change's description:
&gt; Reland "SearchPre: [4.2]Add final status metrics for response reader"
&gt;
&gt; This is a reland of commit ac79d597e15d092c2c04e5d87e49e21e0698019d
&gt; Compared to its initial version, this CL compresses several status
&gt; into one. The reader might end up different statuses given different
&gt; order of executing Mojo tasks, and cannot guarantee the same status
&gt; will be recorded every time.
&gt; In this case, this CL merges the similar ones into kServingError.
&gt;
&gt; This CL also fixes a race condition.
&gt; Since reader is deleted as an asynchronous task, while loader can be
&gt; deleted synchronously, we cannot guarantee that reader is destroyed
&gt; before loader, and need to pass a weakptr instead of a raw pointer.
&gt;
&gt;
&gt; Original change's description:
&gt; &gt; SearchPre: [4.2]Add final status metrics for response reader
&gt; &gt;
&gt; &gt; This CL adds a metric to track ResponseReader's status in different
&gt; &gt; stages.
&gt; &gt; This CL also changes the order of informing different clients of
&gt; &gt; URLLoaderCompletionStatus, so then prerender can always receive the
&gt; &gt; status.
&gt; &gt;
&gt; &gt; Bug: 1400881
&gt; &gt; Change-Id: <a href="https://chromium-review.googlesource.com/#/q/I92520d53b58416c02b1170690e8115cf55934187">I92520d53b58416c02b1170690e8115cf55934187</a>
&gt; &gt; Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/4344850">https://chromium-review.googlesource.com/c/chromium/src/+/4344850</a>
&gt; &gt; Reviewed-by: Hiroki Nakagawa &lt;nhiroki@chromium.org&gt;
&gt; &gt; Commit-Queue: Lingqi Chi &lt;lingqi@chromium.org&gt;
&gt; &gt; Reviewed-by: Takashi Toyoshima &lt;toyoshim@chromium.org&gt;
&gt; &gt; Reviewed-by: Ryan Sturm &lt;ryansturm@chromium.org&gt;
&gt; &gt; Cr-Commit-Position: refs/heads/main@{#1120502}
&gt;
&gt; Bug: 1400881
&gt; Change-Id: <a href="https://chromium-review.googlesource.com/#/q/I331e608cf12e2399cd866c9bae1bedc297e1d46f">I331e608cf12e2399cd866c9bae1bedc297e1d46f</a>
&gt; Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/4364320">https://chromium-review.googlesource.com/c/chromium/src/+/4364320</a>
&gt; Reviewed-by: Takashi Toyoshima &lt;toyoshim@chromium.org&gt;
&gt; Reviewed-by: Hiroki Nakagawa &lt;nhiroki@chromium.org&gt;
&gt; Reviewed-by: Kouhei Ueno &lt;kouhei@chromium.org&gt;
&gt; Commit-Queue: Lingqi Chi &lt;lingqi@chromium.org&gt;
&gt; Reviewed-by: Ryan Sturm &lt;ryansturm@chromium.org&gt;
&gt; Code-Coverage: Findit &lt;findit-for-me@appspot.gserviceaccount.com&gt;
&gt; Cr-Commit-Position: refs/heads/main@{#1123491}

Bug: 1400881
Change-Id: <a href="https://chromium-review.googlesource.com/#/q/I12c86130e1d4d17e89f1800b4c2564cb75f84191">I12c86130e1d4d17e89f1800b4c2564cb75f84191</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/4381020">https://chromium-review.googlesource.com/c/chromium/src/+/4381020</a>
Reviewed-by: Ryan Sturm &lt;ryansturm@chromium.org&gt;
Reviewed-by: Hiroki Nakagawa &lt;nhiroki@chromium.org&gt;
Reviewed-by: Takashi Toyoshima &lt;toyoshim@chromium.org&gt;
Commit-Queue: Lingqi Chi &lt;lingqi@chromium.org&gt;
Cr-Commit-Position: refs/heads/main@{#1126400}
</pre>

</body>
</html>
