<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/927980/"> 927980</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/7856403d3b5da118b8d48dc0da663227aa9f2925">7856403d3b5da118b8d48dc0da663227aa9f2925</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/927965/">927965</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/554a8126a4c70fe941b9fcdb31d57ce13a1c7aaf">554a8126a4c70fe941b9fcdb31d57ce13a1c7aaf</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   7856403d3b5da118b8d48dc0da663227aa9f2925
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/7856403d3b5da118b8d48dc0da663227aa9f2925">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/7856403d3b5da118b8d48dc0da663227aa9f2925.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   Peter Marshall &lt;petermarshall@chromium.org&gt;
  </td>
  <td>
   Tue Oct 05 02:54:18 2021
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Tue Oct 05 02:54:18 2021
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/7856403d3b5da118b8d48dc0da663227aa9f2925/">
    7ff5ee13bc0cedf8d27323f98e93c56fcb551160
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/7856403d3b5da118b8d48dc0da663227aa9f2925%5E">
    359ce402926243cfe47877cea3559cf42c94c411
   </a>
   <span>
    [
    <a href="/chromium/src/+/7856403d3b5da118b8d48dc0da663227aa9f2925%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table><hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">Reland: [IntentHandling] Register Chrome app file_handlers

Reland this CL with some changes to make sure we publish the
QuickOffice extension in ExtensionAppsChromeOs. It has
file_handlers and was previously dealt with in
FindFileHandlerTasks, so we need to move it to App Service too.

CL:3189394 added a test for QuickOffice that fails under the
old CL without these changes.

This reland also adds some pieces from the follow up CL:3168581
which are actually necessary as there are tests in the tree
that rely on them but don't run on pre-submit.

Diff from original CL:
 - Allow QuickOffice in ExtensionAppsChromeOs::Accepts()
 - Exempt QuickOffice in ShouldIgnoreApp()
 - app_service_file_tasks.cc pieces from CL:3168581
 - CreateChromeAppIntentFilters() pieces from CL:3168581


Original description:

Create IntentFilters for Chrome app file_handlers that allow them
to show up in GetAppsForIntent() for Intents with files.

Add some functionality to the Intent system like matching against
directories, which is needed for the include_directories option
for Chrome app file_handlers which does not exist for SWAs/PWAs.

We add is_directory to IntentFile, rather than try to guess based
on URL, because we actually have this information in
FindAppServiceTasks() - the EntryInfo for each file has an
is_directory field, and this info is from the file system so is
much more trustworthy.

Change GetAppsForFiles() to accept a list of IntentFiles directly,
as we would otherwise need to add an array of is_directory bools
anyway, which is getting a bit cumbersome.

Move behaviour from IsGoodMatchFileHandler() in file_tasks.cc into
FindAppServiceTasks(). This deals with finding the "best" handler
within a single app for the given intent - based on product
decisions. We can't do this in post-processing because we only
return one handler per app. This allows us to return
is_generic_file_handler in each IntentLaunchInfo.

Ignore all Chrome app handlers with verbs other than "open_with".
In Files app, we were already ignoring these handlers and there
was no way to see them or use them from the UI. This CL extends
that into the FindAllTasks API, which requires changing a few
tests which expected handlers for other verbs to be returned.
This allows a simpler implementation and has no user-visible
effects.

Drive-by fix a bug in FilterIsForFileExtensions() where we didn't
account for kAction conditions.

Cq-Include-Trybots: luci.chrome.try:linux-chromeos-chrome
Bug: 1240018
Change-Id: <a href="https://chromium-review.googlesource.com/#/q/Ic2df3af1c7737d2ce4fe752c758711e488128b1f">Ic2df3af1c7737d2ce4fe752c758711e488128b1f</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/3193930">https://chromium-review.googlesource.com/c/chromium/src/+/3193930</a>
Commit-Queue: Peter Marshall &lt;petermarshall@chromium.org&gt;
Reviewed-by: Dominick Ng &lt;dominickn@chromium.org&gt;
Reviewed-by: Lei Zhang &lt;thestig@chromium.org&gt;
Reviewed-by: Erik Chen &lt;erikchen@chromium.org&gt;
Reviewed-by: Asanka Herath &lt;asanka@chromium.org&gt;
Reviewed-by: Maggie Cai &lt;mxcai@chromium.org&gt;
Cr-Commit-Position: refs/heads/main@{#927980}
</pre>

</body>
</html>
