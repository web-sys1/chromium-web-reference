<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/967993/"> 967993</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/ecdc736223cfabe49a67f02b61f72b696a839588">ecdc736223cfabe49a67f02b61f72b696a839588</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/967940/">967940</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/75d687dbf524939c98772ece2419f490e792d3e9">75d687dbf524939c98772ece2419f490e792d3e9</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   ecdc736223cfabe49a67f02b61f72b696a839588
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/ecdc736223cfabe49a67f02b61f72b696a839588">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/ecdc736223cfabe49a67f02b61f72b696a839588.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   Xiaohan Wang &lt;xhwang@chromium.org&gt;
  </td>
  <td>
   Mon Feb 07 21:29:28 2022
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Mon Feb 07 21:29:28 2022
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/ecdc736223cfabe49a67f02b61f72b696a839588/">
    e3dacd53e5a9bdfcc0ff63fd96a0d87f1083b90a
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/ecdc736223cfabe49a67f02b61f72b696a839588%5E">
    f15c6ca031f7022529106307892e1cc92cb17601
   </a>
   <span>
    [
    <a href="/chromium/src/+/ecdc736223cfabe49a67f02b61f72b696a839588%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table><hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">media: Make AddSupportedKeySystems() Async

Currently AddSupportedKeySystems() is a sync call, which requires a
sync IPC at lower level. It also causes renderer hang in some cases due
to slower system queries.

This CL makes AddSupportedKeySystems() an async operation to solve that.
More detailed changes include:
- Update WebEncryptedMediaClientImpl to make sure key systems are up to
  date before calling into KeySystemConfigSelector.
- Update KeySystems to update the key systems asynchronously, including
  handling multiple queries and pending updates etc.
- Update AddSupportedKeySystems() to be async along the stack.

Also rename AddSupportedKeySystems() to GetSupportedKeySystems() since
it's now async.

The actual IPC call is still sync and will be updated in the next CL,
since this CL is getting big.

Bug: b/213941141
Test: Updated unit tests
Change-Id: <a href="https://chromium-review.googlesource.com/#/q/Id143ebd474a682858270524d5f44a16abba18ee6">Id143ebd474a682858270524d5f44a16abba18ee6</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/3430502">https://chromium-review.googlesource.com/c/chromium/src/+/3430502</a>
Reviewed-by: Yuchen Liu &lt;yucliu@chromium.org&gt;
Reviewed-by: Alex Moshchuk &lt;alexmos@chromium.org&gt;
Reviewed-by: John Rummell &lt;jrummell@chromium.org&gt;
Reviewed-by: Bo Liu &lt;boliu@chromium.org&gt;
Reviewed-by: Sergey Ulanov &lt;sergeyu@chromium.org&gt;
Commit-Queue: Xiaohan Wang &lt;xhwang@chromium.org&gt;
Cr-Commit-Position: refs/heads/main@{#967993}
</pre>

</body>
</html>
