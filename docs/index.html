<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/890828/"> 890828</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/b643eb3be44781ea8ea28ec46fc6af25264389e7">b643eb3be44781ea8ea28ec46fc6af25264389e7</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/890853/">890853</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/b56c921dc8c64ae3d7b5a3a04b168e7773dc77d6">b56c921dc8c64ae3d7b5a3a04b168e7773dc77d6</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   b643eb3be44781ea8ea28ec46fc6af25264389e7
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/b643eb3be44781ea8ea28ec46fc6af25264389e7">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/b643eb3be44781ea8ea28ec46fc6af25264389e7.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   manukh &lt;manukh@chromium.org&gt;
  </td>
  <td>
   Wed Jun 09 17:12:56 2021
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Wed Jun 09 17:12:56 2021
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/b643eb3be44781ea8ea28ec46fc6af25264389e7/">
    41d1c420412610e290872b3e31e8739b7fbbdcb8
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/b643eb3be44781ea8ea28ec46fc6af25264389e7%5E">
    42f92808ecfd56dc67d3589aeeca97de79eee68a
   </a>
   <span>
    [
    <a href="/chromium/src/+/b643eb3be44781ea8ea28ec46fc6af25264389e7%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table><hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">[omnibox] [rich-autocompletion] IME compatibility.

Moves `omnibox_additional_text_view_` after
`ime_inline_autocomplete_view_`. This fixes the case when there is title
AC with IME which would previously display the URL in between the input
and autocompletion. E.g., input 'あ' and suggestion title 'ああ':
  Before: あ    (URL.com)[あ]
  Now:    あ[あ]    (URL.com)


Adds `ime_prefix_autocomplete_view_` before `omnibox_view_`. This fixes
the case when there is non prefix AC with IME which would previously
hide the prefix autocompletion and calculate the suffix autocompletion
as if the user input matched the suggestion prefix. E.g., input 'あ' and
suggestion 'url.com/ああ':
  - Before: あ[rl.com/ああ]
  - Now:    [url.com/]あ[あ]


Simplifies location bar layout calculations. Previously:
  1) The entire width would be allocated for the omnibox
  2) The omnibox would be resized to its required width if there was IME
autocompletion
  3) The 2 views would be further adjusted if there was insufficient
width to completely display both
  4) Additional processing would be done to split the allocated omnibox
width between itself and `omnibox_additional_text_view_`.

This approach had issues:
  - It was difficult to scale for the new
`ime_prefix_autocomplete_view_`
  - It was unclear if steps (3) and (4) worked correctly together; i.e.
the case when there was title AC, IME AC, and a small location bar
width.
  - It incorrectly preferred IME autocompletion over the user input when
there was a small location bar. This was inconsistent with non-IME
autocompletion.

The new approach:
  1) If the additional views are not visible, allocate the entire width
for the omnibox and skip the following steps. Otherwise:
  2) Distribute the available width between the 4 views with correct
preference when there's insufficient width to display all.
  3) Place them adjacently left to right.

Step 1 in the new approach helps reduce the cases when the omnibox
scroll is dirtied due to the omnibox resizing. It's not foolproof; e.g.,
it's not possible to skip resizing the omnibox when IME or title
autocompletion are present. But it is the status quo; i.e. it doesn't
make the edge cases worse or more frequent. I'll explore a more robust
alternative in followup CL.


Removes the omnibox's border. Previously, the omnibox had a 3px border
on all sides. Removing the border doesn't effect it when there is no IME
autocompletion; importantly, the omnibox text will continue to be
correctly left-aligned with the suggestion text. However, removing this
border fixes positioning when there is IME autocompletion. This was
especially noticeable when beginning IME input would shift the input 3px
and the autocompletion 6px to the right. E.g., input 'あ' and suggestion
'あああ':
  - Before: [あ] あ [あ]
  - Now:    [あ]あ[あ]


Bug: 1062446
Change-Id: <a href="https://chromium-review.googlesource.com/#/q/Idf6d208afd119e9e08a4762761ef853d3a173d04">Idf6d208afd119e9e08a4762761ef853d3a173d04</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/2924246">https://chromium-review.googlesource.com/c/chromium/src/+/2924246</a>
Reviewed-by: Stepan Khapugin &lt;stkhapugin@chromium.org&gt;
Reviewed-by: Tommy Li &lt;tommycli@chromium.org&gt;
Commit-Queue: manuk hovanesian &lt;manukh@chromium.org&gt;
Cr-Commit-Position: refs/heads/master@{#890828}
</pre>

</body>
</html>
