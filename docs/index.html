<!DOCTYPE html>
<html>
<head>
<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
<meta content="utf-8" http-equiv="encoding">
<base href="https://chromium.googlesource.com/">
<style type="text/css">
table.blueTable {
  border: 1px solid #1C6EA4;
  background-color: #EEEEEE;
  width: 100%;
  text-align: center;
  border-collapse: collapse;
}
table.blueTable td, table.blueTable th {
  border: 1px solid #AAAAAA;
  padding: 3px 2px;
}
table.blueTable tbody td {
  font-size: 16px;
}
table.blueTable tr:nth-child(even) {
  background: #D0E4F5;
}
table.blueTable thead {
  background: #3077A4;
  background: -moz-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: -webkit-linear-gradient(top, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  background: linear-gradient(to bottom, #6499bb 0%, #4484ad 66%, #3077A4 100%);
  border-bottom: 2px solid #444444;
}
table.blueTable thead th {
  font-size: 15px;
  font-weight: bold;
  color: #FFFFFF;
  text-align: center;
  border-left: 2px solid #D0E4F5;
}
table.blueTable thead th:first-child {
  border-left: none;
}
table.blueTable tfoot {
  font-size: 8px;
  font-weight: bold;
  color: #FFFFFF;
  background: #D0E4F5;
  background: -moz-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: -webkit-linear-gradient(top, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  background: linear-gradient(to bottom, #dcebf7 0%, #d4e6f6 66%, #D0E4F5 100%);
  border-top: 2px solid #444444;
}
table.blueTable tfoot td {
  font-size: 8px;
}
table.blueTable tfoot .links {
  text-align: right;
}
table.blueTable tfoot .links a{
  display: inline-block;
  background: #1C6EA4;
  color: #FFFFFF;
  padding: 2px 8px;
  border-radius: 5px;
}
body{
    background: #fff2e0;
}
.Metadata {
    margin-bottom: 15px;
}
.u-monospace {
    font-family: 'Source Code Pro',monospace;
    max-width: 100%;
    overflow-x: scroll;
    border: groove #c33b3b 2px;
}
.MetadataMessage {
    background-color: #b9caff;
    border: 1px solid #de5353;
    color: #000;
    margin: 0;
    padding: 12px;
    white-space: pre-wrap;
}
</style>
</head>
<body>

    <table class="blueTable">
     <thead>
      <tr>
       <th><strong>REVISION ID</strong></th>
       <th>SHA-1 COMMIT</th>
      </tr>
    </thead>
    <tfoot></tfoot>
     <tbody>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Mac/1175912/"> 1175912</a> <sup><b>(MAC)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/838736355c8bd5088c669e9f05ba9975547adc2e">838736355c8bd5088c669e9f05ba9975547adc2e</a></td>
      </tr>
      <tr>
       <td><a href ="https://commondatastorage.googleapis.com/chromium-browser-snapshots/index.html?prefix=Win/1175914/">1175914</a> <sup><b>(WIN)</b></sup></td>
       <td><a href="https://chromium.googlesource.com/chromium/src/+/75777fc5dd15b24fc9cabfe004be612d39609177">75777fc5dd15b24fc9cabfe004be612d39609177</a></td>
     </tbody>
    </table>
   <hr><table>
 <tr>
  <th class="Metadata-title">
   commit
  </th>
  <td>
   838736355c8bd5088c669e9f05ba9975547adc2e
  </td>
  <td>
   <span>
    [
    <a href="/chromium/src/+log/838736355c8bd5088c669e9f05ba9975547adc2e">
     log
    </a>
    ]
   </span>
   <span>
    [
    <a href="/chromium/src/+archive/838736355c8bd5088c669e9f05ba9975547adc2e.tar.gz">
     tgz
    </a>
    ]
   </span>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   author
  </th>
  <td>
   Florian Leimgruber &lt;fleimgruber@google.com&gt;
  </td>
  <td>
   Thu Jul 27 07:46:01 2023
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   committer
  </th>
  <td>
   Chromium LUCI CQ &lt;chromium-scoped@luci-project-accounts.iam.gserviceaccount.com&gt;
  </td>
  <td>
   Thu Jul 27 07:46:01 2023
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   tree
  </th>
  <td>
   <a href="/chromium/src/+/838736355c8bd5088c669e9f05ba9975547adc2e/">
    e0c241f355c40f59009a967e6d4d11b090127755
   </a>
  </td>
 </tr>
 <tr>
  <th class="Metadata-title">
   parent
  </th>
  <td>
   <a href="/chromium/src/+/838736355c8bd5088c669e9f05ba9975547adc2e%5E">
    818633752a47fd6066f81a6a151bae9c24efc0a6
   </a>
   <span>
    [
    <a href="/chromium/src/+/838736355c8bd5088c669e9f05ba9975547adc2e%5E%21/">
     diff
    </a>
    ]
   </span>
  </td>
 </tr>
</table>
<hr style="height:1px;border-width:0;color:gray;background-color:gray"><pre class="u-pre u-monospace MetadataMessage">Fix AutofillTable::MigrateToVersion113...().

Database migration logic should generally not depend on functions that
might change in the future. For example:
- MigrateToVersion113...() is run when the database schema is still in
  version 112 and should be migrated to version 113.
- Assume the implementation uses a function f() that inserts some data
  into some table T.
- A few versions later, a new column is added to T and f() is changed
  to insert a value into this new column as well.
In this case, MigrateToVersion113...() will suddenly start failing,
because the new SQL query in f() references a column that doesn't
exists in the version 112/113 schema.

Exactly this happened in the MigrateToVersion113...() logic - f() is
AddAutofillProfileToTable() in this case.

Currently, for the ProfileTokenQuality project, a new column needs to
be added to the contact_info_type_tokens and local_addresses_type_tokens
tables, which are exactly the tables AddAutofillProfileToTable() reads
from.
Fortunately, the WebDatabase migration unit tests caught this bug
before any new column could be added.

This CL fixes the problem by creating a new function
AddAutofillProfileToTableVersion113(), which represents the state
of AddAutofillProfileToTable(), back when the migration logic was
written.

Bug: 1443393
Change-Id: <a href="https://chromium-review.googlesource.com/#/q/I320c6eca3e209dce71ef75fbbe0e87b77ac44051">I320c6eca3e209dce71ef75fbbe0e87b77ac44051</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/c/chromium/src/+/4721049">https://chromium-review.googlesource.com/c/chromium/src/+/4721049</a>
Reviewed-by: Jihad Hanna &lt;jihadghanna@google.com&gt;
Commit-Queue: Florian Leimgruber &lt;fleimgruber@google.com&gt;
Code-Coverage: Findit &lt;findit-for-me@appspot.gserviceaccount.com&gt;
Cr-Commit-Position: refs/heads/main@{#1175912}
</pre>

</body>
</html>
